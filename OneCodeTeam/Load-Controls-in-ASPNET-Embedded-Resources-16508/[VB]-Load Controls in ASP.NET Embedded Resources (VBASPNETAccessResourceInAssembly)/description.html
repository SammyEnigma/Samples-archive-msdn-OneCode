<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/1c1e217c-1475-400e-91a7-b2be1bd6efa0Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Load Controls in ASP.NET Embedded Resources (VBASPNETAccessResourceInAssembly)</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Load Controls in ASP.NET Embedded Resources (VBASPNETAccessResourceInAssembly)</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            ASP.NET
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            resource, User Control
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Web
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">6/11/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/VBASPNETAccessResourceInAss-ae099b01">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Accessing the user controls and web pages from embedded resources (<a name="OLE_LINK1"></a><a name="OLE_LINK2"><span style="">VBASPNETAccessResourceInAssembly</span></a>)</h1>
<h2>Introduction</h2>
<p class="MsoNormal">This project illustrates how to access user controls and web pages from class library via virtual path. Here we inherit VirtualPathProvider and VirtualFile class for creating a custom path provider, this virtual file system can provide
 a similar file path for accessing many files or code from different application, for example, we can put the same type of files (a.mp3, b.mp3) but in different assemblies (a.dll, b.dll) with a unite virtual path, like
<a href="http://localhost/mp3/a.mp3">http://localhost/mp3/a.mp3</a> and <a href="http://localhost/mp3/b.mp3">
http://localhost/mp3/b.mp3</a>. In this way, our websites become more clearly and interactive.
</p>
<h2>Running the Sample</h2>
<p class="MsoNormal">Please follow these demonstration steps below.</p>
<p class="MsoNormal">Step 1:&nbsp;Open the VBASPNETAccessResourceInAssembly.sln. Expand the VBASPNETAccessResourceInAssembly web application and press Ctrl &#43; F5 to show the Default.aspx.
</p>
<p class="MsoNormal">Step 2: We will see two user controls and two links on the web page, the red border part of the page is come from VBASPNETAssembly project, so as the link below. The blue border part of the page and the ��WebSite/WebPage�� link are come
 from this project.</p>
<p class="MsoNormal"><span style=""><span style="">&nbsp;</span> <img src="description/image.png" alt="" width="537" height="374" align="middle">
</span></p>
<p class="MsoNormal">Step 3: You can click the two links for viewing pages in different assemblies. The ��Assembly/WebPage�� link is VBASPNETAssembly project��s page and the ��Website/WebPage�� is current project��s page.</p>
<p class="MsoNormal">The page comes from VBASPNETAssembly:</p>
<p class="MsoNormal"><span style=""><img src="description/8884f2ee-9b56-4197-a2d7-c4399f01b8f3image.png" alt="" width="537" height="374" align="middle">
</span></p>
<p class="MsoNormal">The page comes from this project:</p>
<p class="MsoNormal"><span style=""><img src="description/2a9355dd-a89d-4710-9e64-98141ad05875image.png" alt="" width="537" height="374" align="middle">
</span></p>
<p class="MsoNormal">Step 4: Validation finished.</p>
<h2>Using the Code</h2>
<p class="MsoNormal">Code Logical: </p>
<p class="MsoNormal">Step 1. Create a VB &quot;ASP.NET Empty Web Application&quot; in Visual Studio 2010 or Visual Web Developer 2010. Name it as &quot;VBASPNETAccessResourceInAssembly &quot;. The application need create two projects,<span style="">&nbsp;
</span>��VBASPNETAccessResourceInAssembly��, ��VBASPNETAssembly��. </p>
<p class="MsoNormal">Step 2. Add a user control and a web form page in the project ��VBASPNETAssembly��, this project is the target project, another project will access these resources. For making difference with other pages or user controls, we need add
 some text and special color border with them.<span style="">&nbsp; </span></p>
<p class="MsoNormal">Step 3. Add a folder with web pages and user controls to ��VBASPNETAccessResourceInAssembly�� project like step 2, we also need add some text and borders. Then we need to add a master page for display the resources of all projects, add
 a web form page and name it as ��Default.aspx��, and load user controls and links in code behind file. For the normal web page and user controls, we can add the relative path directly, but for the resources of other assemblies, we need add some special information
 to combine a little complex url string.</p>
<h3>The following code is use to add user controls and links in Default.aspx page.</h3>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">vb</span>
<pre class="hidden">
Public Class _Default
    Inherits <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.UI.Page.aspx"  title="Auto generated link to System.Web.UI.Page">System.Web.UI.Page</a>


    Protected Sub Page_Load(ByVal sender As Object, ByVal e As <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.EventArgs.aspx"  title="Auto generated link to System.EventArgs">System.EventArgs</a>) Handles Me.Load
        ' Add relative web pages and user controls in assembly and this application.
        Dim tab As DataTable = Me.InitializeDataTable()
        If tab IsNot Nothing AndAlso tab.Rows.Count &lt;&gt; 0 Then
            For i As Integer = 0 To tab.Rows.Count - 1
                Dim control As Control = Page.LoadControl(tab.Rows(i)(&quot;UserControlUrl&quot;).ToString())
                Dim usercontrol As UserControl = TryCast(control, UserControl)
                Page.Controls.Add(usercontrol)
                Dim link As New HyperLink()
                link.NavigateUrl = tab.Rows(i)(&quot;WebPageUrl&quot;).ToString()
                link.Text = tab.Rows(i)(&quot;WebPageText&quot;).ToString()
                Page.Controls.Add(link)
            Next
        End If
    End Sub


    ''' &lt;summary&gt;
    ''' Initialize a DataTable variable for storing URL and text properties. 
    ''' &lt;/summary&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    Protected Function InitializeDataTable() As DataTable
        Dim tab As New DataTable()
        Dim userControlUrl As New DataColumn(&quot;UserControlUrl&quot;, Type.[GetType](&quot;System.String&quot;))
        tab.Columns.Add(userControlUrl)
        Dim webPageUrl As New DataColumn(&quot;WebPageUrl&quot;, Type.[GetType](&quot;System.String&quot;))
        tab.Columns.Add(webPageUrl)
        Dim webPageText As New DataColumn(&quot;WebPageText&quot;, Type.[GetType](&quot;System.String&quot;))
        tab.Columns.Add(webPageText)
        Dim dr As DataRow = tab.NewRow()
        dr(&quot;UserControlUrl&quot;) = &quot;~/Assembly/VBASPNETAssembly.dll/VBASPNETAssembly.WebUserControl.ascx&quot;
        dr(&quot;WebPageUrl&quot;) = &quot;~/Assembly/VBASPNETAssembly.dll/VBASPNETAssembly.WebPage.aspx&quot;
        dr(&quot;WebPageText&quot;) = &quot;Assembly/WebPage&quot;
        Dim drWebSite As DataRow = tab.NewRow()
        drWebSite(&quot;UserControlUrl&quot;) = &quot;~/WebSite/WebUserControl.ascx&quot;
        drWebSite(&quot;WebPageUrl&quot;) = &quot;~/WebSite/WebPage.aspx&quot;
        drWebSite(&quot;WebPageText&quot;) = &quot;WebSite/WebPage&quot;
        tab.Rows.Add(dr)
        tab.Rows.Add(drWebSite)
        Return tab
    End Function
End Class

</pre>
<pre id="codePreview" class="vb">
Public Class _Default
    Inherits <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.UI.Page.aspx"  title="Auto generated link to System.Web.UI.Page">System.Web.UI.Page</a>


    Protected Sub Page_Load(ByVal sender As Object, ByVal e As <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.EventArgs.aspx"  title="Auto generated link to System.EventArgs">System.EventArgs</a>) Handles Me.Load
        ' Add relative web pages and user controls in assembly and this application.
        Dim tab As DataTable = Me.InitializeDataTable()
        If tab IsNot Nothing AndAlso tab.Rows.Count &lt;&gt; 0 Then
            For i As Integer = 0 To tab.Rows.Count - 1
                Dim control As Control = Page.LoadControl(tab.Rows(i)(&quot;UserControlUrl&quot;).ToString())
                Dim usercontrol As UserControl = TryCast(control, UserControl)
                Page.Controls.Add(usercontrol)
                Dim link As New HyperLink()
                link.NavigateUrl = tab.Rows(i)(&quot;WebPageUrl&quot;).ToString()
                link.Text = tab.Rows(i)(&quot;WebPageText&quot;).ToString()
                Page.Controls.Add(link)
            Next
        End If
    End Sub


    ''' &lt;summary&gt;
    ''' Initialize a DataTable variable for storing URL and text properties. 
    ''' &lt;/summary&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    Protected Function InitializeDataTable() As DataTable
        Dim tab As New DataTable()
        Dim userControlUrl As New DataColumn(&quot;UserControlUrl&quot;, Type.[GetType](&quot;System.String&quot;))
        tab.Columns.Add(userControlUrl)
        Dim webPageUrl As New DataColumn(&quot;WebPageUrl&quot;, Type.[GetType](&quot;System.String&quot;))
        tab.Columns.Add(webPageUrl)
        Dim webPageText As New DataColumn(&quot;WebPageText&quot;, Type.[GetType](&quot;System.String&quot;))
        tab.Columns.Add(webPageText)
        Dim dr As DataRow = tab.NewRow()
        dr(&quot;UserControlUrl&quot;) = &quot;~/Assembly/VBASPNETAssembly.dll/VBASPNETAssembly.WebUserControl.ascx&quot;
        dr(&quot;WebPageUrl&quot;) = &quot;~/Assembly/VBASPNETAssembly.dll/VBASPNETAssembly.WebPage.aspx&quot;
        dr(&quot;WebPageText&quot;) = &quot;Assembly/WebPage&quot;
        Dim drWebSite As DataRow = tab.NewRow()
        drWebSite(&quot;UserControlUrl&quot;) = &quot;~/WebSite/WebUserControl.ascx&quot;
        drWebSite(&quot;WebPageUrl&quot;) = &quot;~/WebSite/WebPage.aspx&quot;
        drWebSite(&quot;WebPageText&quot;) = &quot;WebSite/WebPage&quot;
        tab.Rows.Add(dr)
        tab.Rows.Add(drWebSite)
        Return tab
    End Function
End Class

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal"></p>
<p class="MsoNormal">Step 4. Everything is fine, now we can begin to create a custom virtual file system. In the first step, create a class to inherit the VirtualPathProvider class and override some necessary methods, such as<span style="">&nbsp;
</span>FileExists, GetFile, GetCacheDependency, this class is use to receive and analyse the message that can get the correct resources in a web request.</p>
<h3>The following code is a custom virtual path provider class that can distinguish the ��Assembly/xxx�� folder.
</h3>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">vb</span>
<pre class="hidden">
Imports <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.Hosting.aspx"  title="Auto generated link to System.Web.Hosting">System.Web.Hosting</a>


Public Class CustomPathProvider
    Inherits VirtualPathProvider


    ''' &lt;summary&gt;
    ''' Make a judgment that application find path contains specifical folder name.
    ''' &lt;/summary&gt;
    ''' &lt;param name=&quot;path&quot;&gt;&lt;/param&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    Private Function AssemblyPathExist(ByVal path As String) As Boolean
        Dim relateivePath As String = VirtualPathUtility.ToAppRelative(path)
        Return relateivePath.StartsWith(&quot;~/Assembly/&quot;, StringComparison.InvariantCultureIgnoreCase)
    End Function
    ''' &lt;summary&gt;
    ''' If we can find this virtual path, return true.
    ''' &lt;/summary&gt;
    ''' &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    ''' &lt;remarks&gt;&lt;/remarks&gt;
    Public Overrides Function FileExists(ByVal virtualPath As String) As Boolean
        If Me.AssemblyPathExist(virtualPath) Then
            Return True
        Else
            Return MyBase.FileExists(virtualPath)
        End If
    End Function
    ''' &lt;summary&gt;
    ''' Use custom VirtualFile class to load assembly resources.
    ''' &lt;/summary&gt;
    ''' &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    ''' &lt;remarks&gt;&lt;/remarks&gt;
    Public Overrides Function GetFile(ByVal virtualPath As String) As <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.Hosting.VirtualFile.aspx"  title="Auto generated link to System.Web.Hosting.VirtualFile">System.Web.Hosting.VirtualFile</a>
        If AssemblyPathExist(virtualPath) Then
            Return New CustomFile(virtualPath)
        Else
            Return MyBase.GetFile(virtualPath)
        End If
    End Function
    ''' &lt;summary&gt;
    ''' Return null when application use virtual file path.
    ''' &lt;/summary&gt;
    ''' &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;
    ''' &lt;param name=&quot;virtualPathDependencies&quot;&gt;&lt;/param&gt;
    ''' &lt;param name=&quot;utcStart&quot;&gt;&lt;/param&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    Public Overrides Function GetCacheDependency(ByVal virtualPath As String, ByVal virtualPathDependencies As IEnumerable, ByVal utcStart As DateTime) As CacheDependency
        If AssemblyPathExist(virtualPath) Then
            Return Nothing
        Else
            Return MyBase.GetCacheDependency(virtualPath, virtualPathDependencies, utcStart)
        End If
    End Function
End Class

</pre>
<pre id="codePreview" class="vb">
Imports <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.Hosting.aspx"  title="Auto generated link to System.Web.Hosting">System.Web.Hosting</a>


Public Class CustomPathProvider
    Inherits VirtualPathProvider


    ''' &lt;summary&gt;
    ''' Make a judgment that application find path contains specifical folder name.
    ''' &lt;/summary&gt;
    ''' &lt;param name=&quot;path&quot;&gt;&lt;/param&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    Private Function AssemblyPathExist(ByVal path As String) As Boolean
        Dim relateivePath As String = VirtualPathUtility.ToAppRelative(path)
        Return relateivePath.StartsWith(&quot;~/Assembly/&quot;, StringComparison.InvariantCultureIgnoreCase)
    End Function
    ''' &lt;summary&gt;
    ''' If we can find this virtual path, return true.
    ''' &lt;/summary&gt;
    ''' &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    ''' &lt;remarks&gt;&lt;/remarks&gt;
    Public Overrides Function FileExists(ByVal virtualPath As String) As Boolean
        If Me.AssemblyPathExist(virtualPath) Then
            Return True
        Else
            Return MyBase.FileExists(virtualPath)
        End If
    End Function
    ''' &lt;summary&gt;
    ''' Use custom VirtualFile class to load assembly resources.
    ''' &lt;/summary&gt;
    ''' &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    ''' &lt;remarks&gt;&lt;/remarks&gt;
    Public Overrides Function GetFile(ByVal virtualPath As String) As <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.Hosting.VirtualFile.aspx"  title="Auto generated link to System.Web.Hosting.VirtualFile">System.Web.Hosting.VirtualFile</a>
        If AssemblyPathExist(virtualPath) Then
            Return New CustomFile(virtualPath)
        Else
            Return MyBase.GetFile(virtualPath)
        End If
    End Function
    ''' &lt;summary&gt;
    ''' Return null when application use virtual file path.
    ''' &lt;/summary&gt;
    ''' &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;
    ''' &lt;param name=&quot;virtualPathDependencies&quot;&gt;&lt;/param&gt;
    ''' &lt;param name=&quot;utcStart&quot;&gt;&lt;/param&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    Public Overrides Function GetCacheDependency(ByVal virtualPath As String, ByVal virtualPathDependencies As IEnumerable, ByVal utcStart As DateTime) As CacheDependency
        If AssemblyPathExist(virtualPath) Then
            Return Nothing
        Else
            Return MyBase.GetCacheDependency(virtualPath, virtualPathDependencies, utcStart)
        End If
    End Function
End Class

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal"></p>
<p class="MsoNormal">Step 5. Then we can create a virtual file class that get the path from virtual path provide class and check the url is available or not, and return the relative assembly��s file stream.</p>
<h3><a name="OLE_LINK3"></a><a name="OLE_LINK4"><span style="">The following code shows how to check the url��s useful information and get the stream of resources.</span></a></h3>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">vb</span>
<pre class="hidden">
Imports <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.Hosting.aspx"  title="Auto generated link to System.Web.Hosting">System.Web.Hosting</a>
Imports <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.IO.aspx"  title="Auto generated link to System.IO">System.IO</a>
Imports <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Reflection.aspx"  title="Auto generated link to System.Reflection">System.Reflection</a>


Public Class CustomFile
    Inherits VirtualFile
    Private Property path As String


    Public Sub New(ByVal virtualPath As String)
        MyBase.New(virtualPath)
        path = VirtualPathUtility.ToAppRelative(virtualPath)
    End Sub
    ''' &lt;summary&gt;
    ''' Override Open method to load resource files of assembly.
    ''' &lt;/summary&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    ''' &lt;remarks&gt;&lt;/remarks&gt;
    Public Overrides Function Open() As <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.IO.Stream.aspx"  title="Auto generated link to System.IO.Stream">System.IO.Stream</a>
        Dim strs As String() = path.Split(&quot;/&quot;c)
        Dim name As String = strs(2)
        Dim resourceName As String = strs(3)
        name = <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.IO.Path.Combine.aspx"  title="Auto generated link to System.IO.Path.Combine">System.IO.Path.Combine</a>(HttpRuntime.BinDirectory, name)
        Dim assembly As Assembly = assembly.LoadFile(name)
        If assembly IsNot Nothing Then
            Dim s As Stream = assembly.GetManifestResourceStream(resourceName)
            Return s
        Else
            Return Nothing
        End If
    End Function
End Class

</pre>
<pre id="codePreview" class="vb">
Imports <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.Hosting.aspx"  title="Auto generated link to System.Web.Hosting">System.Web.Hosting</a>
Imports <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.IO.aspx"  title="Auto generated link to System.IO">System.IO</a>
Imports <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Reflection.aspx"  title="Auto generated link to System.Reflection">System.Reflection</a>


Public Class CustomFile
    Inherits VirtualFile
    Private Property path As String


    Public Sub New(ByVal virtualPath As String)
        MyBase.New(virtualPath)
        path = VirtualPathUtility.ToAppRelative(virtualPath)
    End Sub
    ''' &lt;summary&gt;
    ''' Override Open method to load resource files of assembly.
    ''' &lt;/summary&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    ''' &lt;remarks&gt;&lt;/remarks&gt;
    Public Overrides Function Open() As <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.IO.Stream.aspx"  title="Auto generated link to System.IO.Stream">System.IO.Stream</a>
        Dim strs As String() = path.Split(&quot;/&quot;c)
        Dim name As String = strs(2)
        Dim resourceName As String = strs(3)
        name = <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.IO.Path.Combine.aspx"  title="Auto generated link to System.IO.Path.Combine">System.IO.Path.Combine</a>(HttpRuntime.BinDirectory, name)
        Dim assembly As Assembly = assembly.LoadFile(name)
        If assembly IsNot Nothing Then
            Dim s As Stream = assembly.GetManifestResourceStream(resourceName)
            Return s
        Else
            Return Nothing
        End If
    End Function
End Class

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal"></p>
<p class="MsoNormal">Step 6. At last, you need only register the CustomPathProvider class to the Application_Start event. The provider start to work when you try to run this application.</p>
<h3>The following code is use to register the custom path provider class to Application_Start event.</h3>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">vb</span>
<pre class="hidden">
Imports <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.Hosting.aspx"  title="Auto generated link to System.Web.Hosting">System.Web.Hosting</a>
Sub Application_Start(ByVal sender As Object, ByVal e As EventArgs)
    ' Fires when the application is started
    HostingEnvironment.RegisterVirtualPathProvider(New CustomPathProvider())
End Sub

</pre>
<pre id="codePreview" class="vb">
Imports <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.Hosting.aspx"  title="Auto generated link to System.Web.Hosting">System.Web.Hosting</a>
Sub Application_Start(ByVal sender As Object, ByVal e As EventArgs)
    ' Fires when the application is started
    HostingEnvironment.RegisterVirtualPathProvider(New CustomPathProvider())
End Sub

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal"></p>
<p class="MsoNormal">Step 7. Build the application and you can debug it.</p>
<p class="MsoNormal"></p>
<h2>More Information</h2>
<p class="MsoListParagraphCxSpFirst" style=""><span style="font-family:Symbol"><span style="">��<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><a href="http://msdn.microsoft.com/en-us/library/system.web.hosting.virtualpathprovider.aspx">VirtualPathProvider Class</a></p>
<p class="MsoListParagraphCxSpMiddle" style=""><span style="font-family:Symbol"><span style="">��<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><a href="http://msdn.microsoft.com/en-us/library/system.web.hosting.virtualfile.aspx">VirtualFile Class</a></p>
<p class="MsoListParagraphCxSpLast" style=""><span style="font-family:Symbol"><span style="">��<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><a href="http://msdn.microsoft.com/en-us/library/system.web.virtualpathutility.aspx">VirtualPathUtility Class</a></p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="description/f0ce43d4-e8ea-415f-bfdd-f6bb39d3f968image.png">
</a></div>

</div>


    </div>
</body>
</html>
