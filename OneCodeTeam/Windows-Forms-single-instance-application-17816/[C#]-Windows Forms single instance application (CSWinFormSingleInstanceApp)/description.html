<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/a7d1e078-8570-47da-a87b-ff462dfc958dCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Windows Forms single instance application (CSWinFormSingleInstanceApp)</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Windows Forms single instance application (CSWinFormSingleInstanceApp)</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Windows Forms
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Singleton
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">7/22/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/CSWinFormSingleInstanceApp-d1791628">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1><span style="font-family:新宋体">WINDOWS FORMS APPLICATION</span> (<span style="font-family:新宋体">CSWinFormSingleInstanceApp</span>)</h1>
<h2>Introduction</h2>
<p class="MsoNormal">The SingleInstanceApp sample demonstrates how to achieve the goal that only one instance of the application is allowed in Windows Forms application. In this sample, we are taking advantage of VB.NET Framework since it has built-in support
 for single instance application.<span style="">&nbsp; </span></p>
<h2>Running the Sample</h2>
<p class="MsoNormal"><span style=""><img src="description/image.png" alt="" width="300" height="300" align="middle">
</span></p>
<p class="MsoNormal"><span style=""><img src="description/5fa210da-7ced-48a6-ad17-e639b8e67204image.png" alt="" width="300" height="300" align="middle">
</span></p>
<h2>Using the Code</h2>
<p class="MsoListParagraphCxSpFirst" style="text-indent:5.0pt"><span style=""><span style="">1.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>Create a LoginForm which will be used to authenticate the user's indentity.
</p>
<p class="MsoListParagraphCxSpMiddle" style="text-indent:5.0pt"><span style=""><span style="">2.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>Create a MainForm which the user will be redirect to after the user has been authenticated.
</p>
<p class="MsoListParagraphCxSpLast" style="text-indent:5.0pt"><span style=""><span style="">3.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>Create a class inheriting from WindowsFormsApplicationBase, and name<span style="">
</span>it &quot;SingleInstanceApp&quot;.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
//We need to add <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/Microsoft.VisualBasic.aspx"  title="Auto generated link to Microsoft.VisualBasic">Microsoft.VisualBasic</a> reference to use
//WindowsFormsApplicationBase type.
class SingleInstanceApp : WindowsFormsApplicationBase 
{
    public SingleInstanceApp()
    {
    }
    public SingleInstanceApp(Form f)
    {
        //set IsSingleInstance property to true to make the application 
        base.IsSingleInstance = true;
        //set MainForm of the application.
        this.MainForm = f;
    }
}

</pre>
<pre id="codePreview" class="csharp">
//We need to add <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/Microsoft.VisualBasic.aspx"  title="Auto generated link to Microsoft.VisualBasic">Microsoft.VisualBasic</a> reference to use
//WindowsFormsApplicationBase type.
class SingleInstanceApp : WindowsFormsApplicationBase 
{
    public SingleInstanceApp()
    {
    }
    public SingleInstanceApp(Form f)
    {
        //set IsSingleInstance property to true to make the application 
        base.IsSingleInstance = true;
        //set MainForm of the application.
        this.MainForm = f;
    }
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoListParagraph" style="text-indent:5.0pt"><span style=""><span style="">4.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>Create a class <span class="GramE">&quot; SingleInstanceAppStarter</span> &quot; which will be specialized used to start the MessageLoop.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
public class SingleInstanceAppStarter
{
    static SingleInstanceApp app = null;


    //Construct SingleInstanceApp object, and invoke its run method
    public static void Start(Form f, StartupNextInstanceEventHandler handler)
    {
        if (app == null && f != null)
            app = new SingleInstanceApp(f);


        //wire up StartupNextInstance event handler
        app.StartupNextInstance &#43;= handler;
        app.Run(Environment.GetCommandLineArgs());
    }
}

</pre>
<pre id="codePreview" class="csharp">
public class SingleInstanceAppStarter
{
    static SingleInstanceApp app = null;


    //Construct SingleInstanceApp object, and invoke its run method
    public static void Start(Form f, StartupNextInstanceEventHandler handler)
    {
        if (app == null && f != null)
            app = new SingleInstanceApp(f);


        //wire up StartupNextInstance event handler
        app.StartupNextInstance &#43;= handler;
        app.Run(Environment.GetCommandLineArgs());
    }
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoListParagraph" style="text-indent:5.0pt"><span style=""><span style="">5.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>If the user has not loggined in the application, and the user tries to start another instance, the LoginForm will be activated.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
//The handler when attemping to start another instance of this application
//We can customize the logic here for which form to activate in different 
//conditions. Like in this sample, we will be selctively activate the LoginForm
//or MainForm based on the login state of the user.
static void StartNewInstance(object sender, StartupNextInstanceEventArgs e)
{
    FormCollection forms = Application.OpenForms;
    if (forms[&quot;LoginForm&quot;] != null && forms[&quot;LoginForm&quot;].WindowState== FormWindowState.Minimized)
    {
        forms[&quot;LoginForm&quot;].WindowState = FormWindowState.Normal;
        forms[&quot;LoginForm&quot;].Activate();
    }
    else if (forms[&quot;LoginForm&quot;] == null && GlobleData.IsUserLoggedIn == false)
    {
        LoginForm f = new LoginForm();
        f.ShowDialog();
    }
}

</pre>
<pre id="codePreview" class="csharp">
//The handler when attemping to start another instance of this application
//We can customize the logic here for which form to activate in different 
//conditions. Like in this sample, we will be selctively activate the LoginForm
//or MainForm based on the login state of the user.
static void StartNewInstance(object sender, StartupNextInstanceEventArgs e)
{
    FormCollection forms = Application.OpenForms;
    if (forms[&quot;LoginForm&quot;] != null && forms[&quot;LoginForm&quot;].WindowState== FormWindowState.Minimized)
    {
        forms[&quot;LoginForm&quot;].WindowState = FormWindowState.Normal;
        forms[&quot;LoginForm&quot;].Activate();
    }
    else if (forms[&quot;LoginForm&quot;] == null && GlobleData.IsUserLoggedIn == false)
    {
        LoginForm f = new LoginForm();
        f.ShowDialog();
    }
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoListParagraph" style="text-indent:5.0pt"><span style=""><span style="">6.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>If the user <span class="SpellE">loggined</span> in the <span class="GramE">
application,</span> and the user tries to start another instance, the MainForm will be activated.<span style="">&nbsp;&nbsp;&nbsp;
</span></p>
<h2>More Information </h2>
<p class="MsoListParagraph" style="text-indent:5.0pt"><span style="font-family:Symbol"><span style="">&bull;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><a href="http://msdn.microsoft.com/en-us/magazine/cc163741.aspx">NET MATTERS: Single-Instance apps</a></p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="description/b54ac75c-991a-4c3a-a697-d8e8f7fa5c86image.png">
</a></div>

</div>


    </div>
</body>
</html>
