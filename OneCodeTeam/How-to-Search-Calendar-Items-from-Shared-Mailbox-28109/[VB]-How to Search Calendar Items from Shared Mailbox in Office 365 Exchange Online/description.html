<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/4f4275e1-bd3e-4e16-97fa-d98bbd47700bCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>How to Search Calendar Items from Shared Mailbox in Office 365 Exchange Online</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>How to Search Calendar Items from Shared Mailbox in Office 365 Exchange Online</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Exchange Online, Office 365
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Search, O365, shared mailbox
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">4/10/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/How-to-Search-Calendar-11437894">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<hr>
<div><a href="http://blogs.msdn.com/b/onecode" style="margin-top:3px"><img alt="" src="description/8171.onecodesampletopbanner.png">
</a></div>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:24pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:14pt"><span style="font-weight:bold; font-size:14pt">How to Search for Calendar Items
</span><span style="font-weight:bold; font-size:14pt">in</span><span style="font-weight:bold; font-size:14pt"> a Shared Mailbox in Office 365 Exchange Online</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt">Introduction</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">Currently, Outlook Web App doesn't allow you to search for calendar items in a shared mailbox. But some of you require this feature for some reasons. In this sample, we will demonstrate how to search
</span><span style="font-size:11pt">for </span><span style="font-size:11pt">calendar items
</span><span style="font-size:11pt">in</span><span style="font-size:11pt"> </span>
<span style="font-size:11pt">a </span><span style="font-size:11pt">shared mailbox:</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:12pt"></span><span style="font-size:12pt">1. Get the shared mailbox that users input</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:12pt"></span><span style="font-size:12pt">2. Get the search filter, such as the start date, end date, subject.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:12pt"></span><span style="font-size:12pt">3. Set the
</span><span style="font-size:12pt">ImpersonatedUserId</span><span style="font-size:12pt"> property if the login account has the impersonation permission.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:12pt"></span><span style="font-size:12pt">4. Search
</span><span style="font-size:12pt">for </span><span style="font-size:12pt">the items in the shared mailbox.
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt">Running the Sample</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">Press F5 to run the sample.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt"><img src="description/image.png" alt="" width="407" height="55" align="middle">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">If you want to search </span>
<span style="font-size:11pt">a</span><span style="font-size:11pt"> shared mailbox, you should have impersonation permission.
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">First, you should input the shared mailbox which you want to search.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt"><img src="description/3e266ff1-b2b5-4025-bae6-b0920b24b9feimage.png" alt="" width="574" height="30" align="middle">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">Then you can define th</span><span style="font-size:11pt">e duration you want to search for</span><span style="font-size:11pt">.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt"><img src="description/baa50788-143b-47fa-9175-85128a892a96image.png" alt="" width="575" height="45" align="middle">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">At last, you can define the subject you want to search</span><span style="font-size:11pt"> for</span><span style="font-size:11pt">, or you can just press Enter to get all the items.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt"><img src="description/77503e51-bc96-427a-aa57-ffb25122191dimage.png" alt="" width="575" height="31" align="middle">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">The r</span><span style="font-size:11pt">esult will
</span><span style="font-size:11pt">be shown </span><span style="font-size:11pt">as follo</span><span style="font-size:11pt">ws</span><span style="font-size:11pt">:</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt"><img src="description/229e3a61-5ae2-4bfc-af35-ece5759910efimage.png" alt="" width="575" height="93" align="middle">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt">Using the Code</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">If we have impersonation permission, we can
</span><span style="font-size:11pt">search</span><span style="font-size:11pt"> for</span><span style="font-size:11pt"> items in
</span><span style="font-size:11pt">a </span><span style="font-size:11pt">shared mailbox</span><span style="font-size:11pt"> by set</span><span style="font-size:11pt">ting</span><span style="font-size:11pt"> ImpersonatedUserId property.</span></span>
</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span><span class="hidden">vb</span>
<pre class="hidden">
// If the shared mailbox identity is valid, we will set it as the ImpersonatedUserId.
NameResolutionCollection nameResolutions =
    service.ResolveName(identity, ResolveNameSearchLocation.DirectoryOnly, false);
if (nameResolutions.Count != 1)
{
    Console.WriteLine(&quot;{0} is invalid Shared Mailbox identity.&quot;, identity);
    Console.WriteLine();
}
else
{
    String emailAddress = nameResolutions[0].Mailbox.Address;
    Console.WriteLine();
    Console.WriteLine(&quot;Please input the start date(15 days before today is the defined date.):&quot;);
    String startDate = Console.ReadLine();
    Console.WriteLine(&quot;Please input the end dateI(30 days after start date is the defined date.):&quot;);
    String endDate = Console.ReadLine();
    Console.WriteLine(&quot;Please input the subject that you want to search(Press Enter directly to get all the itmes):&quot;);
    String searchSubject = Console.ReadLine();
    Console.WriteLine();
    service.ImpersonatedUserId =
        new ImpersonatedUserId(ConnectingIdType.SmtpAddress, emailAddress);
    GetSharedMailboxCalendarItems(service, emailAddress, searchSubject, 
        startDate, endDate);
}
</pre>
<pre class="hidden">
' If the shared mailbox identity is valid, we will set it as the ImpersonatedUserId.
Dim nameResolutions As NameResolutionCollection =
    service.ResolveName(identity, ResolveNameSearchLocation.DirectoryOnly, False)
If nameResolutions.Count &lt;&gt; 1 Then
    Console.WriteLine(&quot;{0} is invalid Shared Mailbox identity.&quot;, identity)
    Console.WriteLine()
Else
    Dim emailAddress As String = nameResolutions(0).Mailbox.Address
    Console.WriteLine()
    Console.WriteLine(&quot;Please input the start date(15 days before today is the defined date.):&quot;)
    Dim startDate As String = Console.ReadLine()
    Console.WriteLine(&quot;Please input the end dateI(30 days after start date is the defined date.):&quot;)
    Dim endDate As String = Console.ReadLine()
    Console.WriteLine(&quot;Please input the subject that you want to search(Press Enter directly to get all the itmes):&quot;)
    Dim searchSubject As String = Console.ReadLine()
    Console.WriteLine()
    service.ImpersonatedUserId =
        New ImpersonatedUserId(ConnectingIdType.SmtpAddress, emailAddress)
    GetSharedMailboxCalendarItems(service, emailAddress, searchSubject,
                                  startDate, endDate)
</pre>
<pre id="codePreview" class="csharp">
// If the shared mailbox identity is valid, we will set it as the ImpersonatedUserId.
NameResolutionCollection nameResolutions =
    service.ResolveName(identity, ResolveNameSearchLocation.DirectoryOnly, false);
if (nameResolutions.Count != 1)
{
    Console.WriteLine(&quot;{0} is invalid Shared Mailbox identity.&quot;, identity);
    Console.WriteLine();
}
else
{
    String emailAddress = nameResolutions[0].Mailbox.Address;
    Console.WriteLine();
    Console.WriteLine(&quot;Please input the start date(15 days before today is the defined date.):&quot;);
    String startDate = Console.ReadLine();
    Console.WriteLine(&quot;Please input the end dateI(30 days after start date is the defined date.):&quot;);
    String endDate = Console.ReadLine();
    Console.WriteLine(&quot;Please input the subject that you want to search(Press Enter directly to get all the itmes):&quot;);
    String searchSubject = Console.ReadLine();
    Console.WriteLine();
    service.ImpersonatedUserId =
        new ImpersonatedUserId(ConnectingIdType.SmtpAddress, emailAddress);
    GetSharedMailboxCalendarItems(service, emailAddress, searchSubject, 
        startDate, endDate);
}
</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style=""></span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">We search </span><span style="font-size:11pt">for
</span><a name="_GoBack"></a><span style="font-size:11pt">items in the specified shared mailbox.</span></span>
</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span><span class="hidden">vb</span>
<pre class="hidden">
static void GetSharedMailboxCalendarItems(ExchangeService service, String emailAddress, 
    String searchSubject, String startDate, String endDate)
{
    // If the date is invaild, we will set 15 days before today as the start date.
    DateTime startSearchDate;
    startSearchDate =
        DateTime.TryParse(startDate, out startSearchDate) ? startSearchDate : DateTime.Now.AddDays(-15);
    // If the date is invaild, we will set 30 days after the start date as the end date.
    DateTime endSearchDate;
    endSearchDate =
        DateTime.TryParse(endDate, out endSearchDate) && endSearchDate &gt;= startSearchDate ?
        endSearchDate : startSearchDate.AddDays(30);
    FolderId folderId = new FolderId(WellKnownFolderName.Calendar);
    SearchFilter.SearchFilterCollection searchFilterCollection = 
        new SearchFilter.SearchFilterCollection();
    searchFilterCollection.LogicalOperator = LogicalOperator.And;
    // If you want search the specified subject, you can define the filter; or you will get all
    // the items that contain the Subject schema.
    if (String.IsNullOrWhiteSpace(searchSubject))
    {
        SearchFilter searchFilter = new SearchFilter.Exists(AppointmentSchema.Subject);
        searchFilterCollection.Add(searchFilter);
    }
    else
    {
        SearchFilter searchFilter = 
            new SearchFilter.ContainsSubstring(AppointmentSchema.Subject, searchSubject);
        searchFilterCollection.Add(searchFilter);
    }
    SearchFilter startDateFilter = 
        new SearchFilter.IsGreaterThanOrEqualTo(AppointmentSchema.DateTimeCreated, startSearchDate);
    SearchFilter endDateFilter = 
        new SearchFilter.IsLessThanOrEqualTo(AppointmentSchema.DateTimeCreated, endSearchDate);
    searchFilterCollection.Add(startDateFilter);
    searchFilterCollection.Add(endDateFilter);
    ItemView itemView = new ItemView(100);
    itemView.PropertySet = new PropertySet(BasePropertySet.FirstClassProperties);
    FindItemsResults&lt;Item&gt; findItems=null;
    Console.WriteLine(&quot;{0,-20}{1,-25}{2,-25}{3,-10}&quot;,&quot;Subject&quot;,&quot;Start&quot;,&quot;End&quot;,&quot;Duration&quot;);
    do
    {
        findItems=service.FindItems(folderId,searchFilterCollection,itemView);
        foreach (Item item in findItems)
        {
            Console.Write(
                &quot;{0,-20}&quot;,item.Subject.Length&gt;18?item.Subject.Substring(0,15)&#43;&quot;...&quot;:item.Subject);
            
            if (item is Appointment)
            {
                Appointment appointment = item as Appointment;
                Console.Write(&quot;{0,-25}&quot;, appointment.Start);
                Console.Write(&quot;{0,-25}&quot;, appointment.End);
                Console.Write(&quot;{0,-10}&quot;, appointment.Duration);
            }
            Console.WriteLine();
        }
    }while(findItems.MoreAvailable);
    Console.WriteLine();
}
</pre>
<pre class="hidden">
Private Shared Sub GetSharedMailboxCalendarItems(ByVal service As ExchangeService,
                                                 ByVal emailAddress As String,
                                                 ByVal searchSubject As String,
                                                 ByVal startDate As String,
                                                 ByVal endDate As String)
    ' If the date is invaild, we will set 15 days before today as the start date.
    Dim startSearchDate As Date
    startSearchDate = If(Date.TryParse(startDate, startSearchDate), startSearchDate,
                         Date.Now.AddDays(-15))
    ' If the date is invaild, we will set 30 days after the start date as the end date.
    Dim endSearchDate As Date
    endSearchDate = If(Date.TryParse(endDate, endSearchDate) AndAlso
                       endSearchDate &gt;= startSearchDate, endSearchDate,
                       startSearchDate.AddDays(30))
    Dim folderId As New FolderId(WellKnownFolderName.Calendar)
    Dim searchFilterCollection As New SearchFilter.SearchFilterCollection()
    searchFilterCollection.LogicalOperator = LogicalOperator.And
    ' If you want search the specified subject, you can define the filter; or you will get all
    ' the items that contain the Subject schema.
    If String.IsNullOrWhiteSpace(searchSubject) Then
        Dim searchFilter As SearchFilter = New SearchFilter.Exists(AppointmentSchema.Subject)
        searchFilterCollection.Add(searchFilter)
    Else
        Dim searchFilter As SearchFilter =
            New SearchFilter.ContainsSubstring(AppointmentSchema.Subject, searchSubject)
        searchFilterCollection.Add(searchFilter)
    End If
    Dim startDateFilter As SearchFilter =
        New SearchFilter.IsGreaterThanOrEqualTo(AppointmentSchema.DateTimeCreated, startSearchDate)
    Dim endDateFilter As SearchFilter =
        New SearchFilter.IsLessThanOrEqualTo(AppointmentSchema.DateTimeCreated, endSearchDate)
    searchFilterCollection.Add(startDateFilter)
    searchFilterCollection.Add(endDateFilter)
    Dim itemView As New ItemView(100)
    itemView.PropertySet = New PropertySet(BasePropertySet.FirstClassProperties)
    Dim findItems As FindItemsResults(Of Item) = Nothing
    Console.WriteLine(&quot;{0,-20}{1,-25}{2,-25}{3,-10}&quot;, &quot;Subject&quot;, &quot;Start&quot;, &quot;End&quot;, &quot;Duration&quot;)
    Do
        findItems = service.FindItems(folderId, searchFilterCollection, itemView)
        For Each item As Item In findItems
            Console.Write(&quot;{0,-20}&quot;, If(item.Subject.Length &gt; 18, item.Subject.Substring(0, 15) & &quot;...&quot;, item.Subject))
            If TypeOf item Is Appointment Then
                Dim appointment As Appointment = TryCast(item, Appointment)
                Console.Write(&quot;{0,-25}&quot;, appointment.Start)
                Console.Write(&quot;{0,-25}&quot;, appointment.End)
                Console.Write(&quot;{0,-10}&quot;, appointment.Duration)
            End If
            Console.WriteLine()
        Next item
    Loop While findItems.MoreAvailable
    Console.WriteLine()
End Sub
</pre>
<pre id="codePreview" class="csharp">
static void GetSharedMailboxCalendarItems(ExchangeService service, String emailAddress, 
    String searchSubject, String startDate, String endDate)
{
    // If the date is invaild, we will set 15 days before today as the start date.
    DateTime startSearchDate;
    startSearchDate =
        DateTime.TryParse(startDate, out startSearchDate) ? startSearchDate : DateTime.Now.AddDays(-15);
    // If the date is invaild, we will set 30 days after the start date as the end date.
    DateTime endSearchDate;
    endSearchDate =
        DateTime.TryParse(endDate, out endSearchDate) && endSearchDate &gt;= startSearchDate ?
        endSearchDate : startSearchDate.AddDays(30);
    FolderId folderId = new FolderId(WellKnownFolderName.Calendar);
    SearchFilter.SearchFilterCollection searchFilterCollection = 
        new SearchFilter.SearchFilterCollection();
    searchFilterCollection.LogicalOperator = LogicalOperator.And;
    // If you want search the specified subject, you can define the filter; or you will get all
    // the items that contain the Subject schema.
    if (String.IsNullOrWhiteSpace(searchSubject))
    {
        SearchFilter searchFilter = new SearchFilter.Exists(AppointmentSchema.Subject);
        searchFilterCollection.Add(searchFilter);
    }
    else
    {
        SearchFilter searchFilter = 
            new SearchFilter.ContainsSubstring(AppointmentSchema.Subject, searchSubject);
        searchFilterCollection.Add(searchFilter);
    }
    SearchFilter startDateFilter = 
        new SearchFilter.IsGreaterThanOrEqualTo(AppointmentSchema.DateTimeCreated, startSearchDate);
    SearchFilter endDateFilter = 
        new SearchFilter.IsLessThanOrEqualTo(AppointmentSchema.DateTimeCreated, endSearchDate);
    searchFilterCollection.Add(startDateFilter);
    searchFilterCollection.Add(endDateFilter);
    ItemView itemView = new ItemView(100);
    itemView.PropertySet = new PropertySet(BasePropertySet.FirstClassProperties);
    FindItemsResults&lt;Item&gt; findItems=null;
    Console.WriteLine(&quot;{0,-20}{1,-25}{2,-25}{3,-10}&quot;,&quot;Subject&quot;,&quot;Start&quot;,&quot;End&quot;,&quot;Duration&quot;);
    do
    {
        findItems=service.FindItems(folderId,searchFilterCollection,itemView);
        foreach (Item item in findItems)
        {
            Console.Write(
                &quot;{0,-20}&quot;,item.Subject.Length&gt;18?item.Subject.Substring(0,15)&#43;&quot;...&quot;:item.Subject);
            
            if (item is Appointment)
            {
                Appointment appointment = item as Appointment;
                Console.Write(&quot;{0,-25}&quot;, appointment.Start);
                Console.Write(&quot;{0,-25}&quot;, appointment.End);
                Console.Write(&quot;{0,-10}&quot;, appointment.Duration);
            }
            Console.WriteLine();
        }
    }while(findItems.MoreAvailable);
    Console.WriteLine();
}
</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style=""></span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt">More Information</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><a href="http://msdn.microsoft.com/en-us/library/dd633709(v=exchg.80).aspx" style="text-decoration:none"><span style="color:#0563C1; text-decoration:underline">EWS Managed API 2.0</span></a><span style="font-size:11pt">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><a href="http://msdn.microsoft.com/en-us/library/dd633680(v=exchg.80).aspx" style="text-decoration:none"><span style="color:#0563C1; text-decoration:underline">Working with impersonation by using the EWS Managed API</span></a></span>
</p>
<p style="line-height:0.6pt; color:white">Microsoft All-In-One Code Framework is a free, centralized code sample library driven by developers' real-world pains and needs. The goal is to provide customer-driven code samples for all Microsoft development technologies,
 and reduce developers' efforts in solving typical programming tasks. Our team listens to developers’ pains in the MSDN forums, social media and various DEV communities. We write code samples based on developers’ frequently asked programming tasks, and allow
 developers to download them with a short sample publishing cycle. Additionally, we offer a free code sample request service. It is a proactive way for our developer community to obtain code samples directly from Microsoft.</p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="description/6b4cf5bf-9f01-459f-b9ba-42bff79b68c6image.png">
</a></div>

</div>


    </div>
</body>
</html>
