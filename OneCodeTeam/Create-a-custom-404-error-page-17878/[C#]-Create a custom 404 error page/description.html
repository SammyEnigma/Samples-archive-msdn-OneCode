<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/67b74b86-a273-4ad7-9ed5-0f97276412eaCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Create a custom 404 error page</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Create a custom 404 error page</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            ASP.NET
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            404
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Web
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">6/13/2013</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/CSASPNETIntelligentErrorPag-d3b51c34">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<p class="MsoNormal">The sample code demonstrates how to create the intelligent error page in Asp.net application. In this sample, we add a custom 404 error
<span class="GramE">page</span> and find the similar local resources, then display them in error page. In this way, we will improve the user-experience, since users
<a name="OLE_LINK2"></a><a name="OLE_LINK1"><span style="">don't need </span>
</a>to face a boring and helpless error page any more.</p>
<p class="MsoNormal">Here is the reason why we need this sample code:</p>
<p class="MsoListParagraphCxSpFirst" style="text-indent:-.25in"><span style=""><span style="">1.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>The normal website will throw you to a boring, inflexible 404 error page when you try to visit a non-exists page.</p>
<p class="MsoListParagraphCxSpMiddle" style="text-indent:-.25in"><span style=""><span style="">2.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>You cannot get more useful information from normal 404 error page and cannot find right
<span class="SpellE"><span class="GramE">url</span></span> path, either.</p>
<p class="MsoListParagraphCxSpLast" style="text-indent:-.25in"><span style=""><span style="">3.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>The customize error page can provide a more friendly ways to tell customers that the current request page is not exist and we can provide some similar web pages for choosing.</p>
<p class="MsoNormal">Please follow these demonstration steps below.</p>
<p class="MsoNormal">Step 1:&nbsp;Open the <span style="">CSASPNETIntelligentErrorPage</span>.sln. Expand the
<span class="SpellE"><span style="">CSASPNETIntelligentErrorPage</span></span> web application and press Ctrl &#43; F5 to show the Default.aspx.
</p>
<p class="MsoNormal">Step 2: The Default.aspx page includes two kinds of link resources, the useful links can be redirected to correct pages and the useless links will be redirected to 404 error pages since the application does not contain these pages.</p>
<p class="MsoNormal"><span style=""><img src="description/image.png" alt="" width="556" height="505" align="middle">
</span><span style="">&nbsp;</span></p>
<p class="MsoNormal">Step 3: The useful links can be found by web application. </p>
<p class="MsoNormal"><span style="">&lt;u1:shape id=&quot;Picture_x0020_3&quot; u2:spid=&quot;_x0000_i1025&quot; type=&quot;#_x0000_t75&quot; alt=&quot;Description: Description: Description: Description: http://www.codeproject.com/KB/vista-security/UACSelfElevation/UACSelfElevation3.png&quot; style=&quot;width:3in;height:167.25pt;visibility:visible;mso-wrap-style:square&quot;&gt;&lt;u1:imagedata
 src=&quot;http://localhost:10242/Documentation/ReadMe_files/image003.png&quot; u2:title=&quot;UACSelfElevation3&quot;/&gt;&lt;/u1:shape&gt;
<img src="description/7ac3fdcd-27cc-4a1a-b4f2-8e8e0e74bb0bimage.png" alt="" width="556" height="505" align="middle">
</span></p>
<p class="MsoNormal"><span class="GramE">Step 4.</span> When you try to visit useless links, the application will check the request name and category properties of your request
<span class="SpellE"><span class="GramE">url</span></span> with XML file. The customers can visit our customized 404 error page.
</p>
<p class="MsoNormal"><span style=""><img src="description/691a1c41-d625-4680-946d-3da9c68afa6eimage.png" alt="" width="556" height="505" align="middle">
</span></p>
<p class="MsoNormal"><span class="GramE">Step 5.</span> If the sample application could not find any relative resources, it will remind user with the message &quot;No similar links&quot;.</p>
<p class="MsoNormal"><span style=""><img src="description/0763ace1-b05e-48ae-a4da-fde4898d6091image.png" alt="" width="556" height="505" align="middle">
</span></p>
<p class="MsoNormal"><span class="GramE">Step 6.</span> Validation finished.</p>
<p class="MsoNormal">Code Logical:</p>
<p class="MsoNormal"><span class="GramE">Step 1.</span> Create a C# &quot;ASP.NET Empty Web Application&quot; in Visual Studio 2010 or Visual Web Developer 2010. Name it as &quot;<span class="SpellE"><span style="">CSASPNETIntelligentErrorPage</span></span>&quot;.
 Add one folder, &quot;Relative Pages&quot;, in order to provide some similar web pages in this sample, we need to add more web pages for testing, for example, we can involve these web form pages in Relative Page folder, &quot;Aspnet.aspx&quot;, &quot;<span class="SpellE">Aspnet_DataControl</span>&quot;,
 &quot;<span class="SpellE">Aspnet_MVC</span>&quot;, &quot;Silverlight&quot;, &quot;<span class="SpellE">Silverlight_Toolkit</span>&quot;, &quot;WCF.aspx&quot;. And we also need an xml file for recording these pages' basic information, so please add an
 xml file named &quot;XmlData.xml&quot; in <span class="SpellE">App_Data</span> folder.</p>
<p class="MsoNormal"><span class="GramE">Step 2.</span> Add two web form pages, &quot;Default.aspx&quot; and &quot;ErrorPage.aspx&quot;, the Default page is used to list some useful and useless link resources, and the
<span class="SpellE">ErrorPage</span> is used to replace default 404 error page. Before we begin to code, add some important sections in
<span class="SpellE">Web.Config</span> to enable custom errors. </p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>XML</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">xml</span>
<pre class="hidden">
&lt;system.web&gt;
    &lt;compilation debug=&quot;true&quot; targetFramework=&quot;4.0&quot; /&gt;


  &lt;customErrors mode=&quot;On&quot; defaultRedirect=&quot;ErrorPage.aspx&quot;&gt; 
    &lt;error statusCode=&quot;404&quot; redirect=&quot;ErrorPage.aspx&quot; /&gt;
    &lt;!--&lt;error statusCode=&quot;403&quot; redirect=&quot;&quot;/&gt;--&gt;
  &lt;/customErrors&gt;
&lt;/system.web&gt;

</pre>
<pre id="codePreview" class="xml">
&lt;system.web&gt;
    &lt;compilation debug=&quot;true&quot; targetFramework=&quot;4.0&quot; /&gt;


  &lt;customErrors mode=&quot;On&quot; defaultRedirect=&quot;ErrorPage.aspx&quot;&gt; 
    &lt;error statusCode=&quot;404&quot; redirect=&quot;ErrorPage.aspx&quot; /&gt;
    &lt;!--&lt;error statusCode=&quot;403&quot; redirect=&quot;&quot;/&gt;--&gt;
  &lt;/customErrors&gt;
&lt;/system.web&gt;

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
public class XmlHandler
{
    DataTable tabItems = new DataTable();
    string xmlPath = string.Empty;
    public XmlHandler(string url)
    {
        this.xmlPath = url;
        DataColumn dcName = new DataColumn(&quot;Name&quot;, Type.GetType(&quot;System.String&quot;));
        DataColumn dcCategory = new DataColumn(&quot;Category&quot;, Type.GetType(&quot;System.String&quot;));
        DataColumn dcUrl = new DataColumn(&quot;Path&quot;, Type.GetType(&quot;System.String&quot;));
        tabItems.Columns.Add(dcName);
        tabItems.Columns.Add(dcCategory);
        tabItems.Columns.Add(dcUrl);
    }


    public DataTable GetOpenData()
    {
        tabItems.Clear();
        XDocument document = XDocument.Load(xmlPath);
        var items = from item in document.Descendants(&quot;Item&quot;)
                    where item.Attribute(&quot;open&quot;).Value == &quot;1&quot;
                    select
                    item;
        foreach (var item in items)
        {
            DataRow dr = tabItems.NewRow();
            dr[&quot;Name&quot;] = item.Element(&quot;Name&quot;).Value;
            dr[&quot;Category&quot;] = item.Element(&quot;Category&quot;).Value;
            dr[&quot;Path&quot;] = item.Element(&quot;Path&quot;).Value;
            tabItems.Rows.Add(dr);
        }
        return tabItems;
    }


    public DataTable GetDataItemByName(string name)
    {
        tabItems.Clear();
        XDocument document = XDocument.Load(xmlPath);
        var items = from item in document.Descendants(&quot;Item&quot;)
                    where item.Element(&quot;Category&quot;).Value.ToLower().Contains(name.ToLower())
                    || item.Element(&quot;Name&quot;).Value.ToLower().Contains(name.ToLower())
                    select new ItemModel
                    {
                        Name = item.Element(&quot;Name&quot;).Value,
                        Category = item.Element(&quot;Category&quot;).Value,
                        Url = item.Element(&quot;Path&quot;).Value
                    };
        foreach (var item in items)
        {
            DataRow dr = tabItems.NewRow();
            dr[&quot;Name&quot;] = item.Name;
            dr[&quot;Category&quot;] = item.Category;
            dr[&quot;Path&quot;] = item.Url;
            tabItems.Rows.Add(dr);
        }
        return tabItems;
    }
}

</pre>
<pre id="codePreview" class="csharp">
public class XmlHandler
{
    DataTable tabItems = new DataTable();
    string xmlPath = string.Empty;
    public XmlHandler(string url)
    {
        this.xmlPath = url;
        DataColumn dcName = new DataColumn(&quot;Name&quot;, Type.GetType(&quot;System.String&quot;));
        DataColumn dcCategory = new DataColumn(&quot;Category&quot;, Type.GetType(&quot;System.String&quot;));
        DataColumn dcUrl = new DataColumn(&quot;Path&quot;, Type.GetType(&quot;System.String&quot;));
        tabItems.Columns.Add(dcName);
        tabItems.Columns.Add(dcCategory);
        tabItems.Columns.Add(dcUrl);
    }


    public DataTable GetOpenData()
    {
        tabItems.Clear();
        XDocument document = XDocument.Load(xmlPath);
        var items = from item in document.Descendants(&quot;Item&quot;)
                    where item.Attribute(&quot;open&quot;).Value == &quot;1&quot;
                    select
                    item;
        foreach (var item in items)
        {
            DataRow dr = tabItems.NewRow();
            dr[&quot;Name&quot;] = item.Element(&quot;Name&quot;).Value;
            dr[&quot;Category&quot;] = item.Element(&quot;Category&quot;).Value;
            dr[&quot;Path&quot;] = item.Element(&quot;Path&quot;).Value;
            tabItems.Rows.Add(dr);
        }
        return tabItems;
    }


    public DataTable GetDataItemByName(string name)
    {
        tabItems.Clear();
        XDocument document = XDocument.Load(xmlPath);
        var items = from item in document.Descendants(&quot;Item&quot;)
                    where item.Element(&quot;Category&quot;).Value.ToLower().Contains(name.ToLower())
                    || item.Element(&quot;Name&quot;).Value.ToLower().Contains(name.ToLower())
                    select new ItemModel
                    {
                        Name = item.Element(&quot;Name&quot;).Value,
                        Category = item.Element(&quot;Category&quot;).Value,
                        Url = item.Element(&quot;Path&quot;).Value
                    };
        foreach (var item in items)
        {
            DataRow dr = tabItems.NewRow();
            dr[&quot;Name&quot;] = item.Name;
            dr[&quot;Category&quot;] = item.Category;
            dr[&quot;Path&quot;] = item.Url;
            tabItems.Rows.Add(dr);
        }
        return tabItems;
    }
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal" style=""><span class="GramE">Step 4.</span> The Default page uses
<span class="SpellE">XmlHandler.GetOpenData</span>() method to get all available resources from xml file and binds them to
<span class="SpellE">ListView</span> control, the Error Page can get file name from request
<span class="SpellE">url</span> string variable and call <span class="SpellE">
XmlHandler.GetItemByName</span>(string name) method to get relative web resources.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
public partial class ErrorPage : <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.UI.Page.aspx"  title="Auto generated link to System.Web.UI.Page">System.Web.UI.Page</a>
{
    const string xmlPath = &quot;~/App_Data/XmlData.xml&quot;;
    protected void Page_Load(object sender, EventArgs e)
    {
        string path = Request.QueryString[&quot;aspxerrorpath&quot;].ToString();
        string fileFullName = path.Substring(path.LastIndexOf('/') &#43; 1);
        string fileName = fileFullName.Substring(0,fileFullName.LastIndexOf('.'));
        XmlHandler handler = new XmlHandler(Server.MapPath(xmlPath));
        DataTable tab = new DataTable();
        tab = handler.GetDataItemByName(fileName);
        lvwPageList.DataSource = tab;
        lvwPageList.DataBind();
    }
}

</pre>
<pre id="codePreview" class="csharp">
public partial class ErrorPage : <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Web.UI.Page.aspx"  title="Auto generated link to System.Web.UI.Page">System.Web.UI.Page</a>
{
    const string xmlPath = &quot;~/App_Data/XmlData.xml&quot;;
    protected void Page_Load(object sender, EventArgs e)
    {
        string path = Request.QueryString[&quot;aspxerrorpath&quot;].ToString();
        string fileFullName = path.Substring(path.LastIndexOf('/') &#43; 1);
        string fileName = fileFullName.Substring(0,fileFullName.LastIndexOf('.'));
        XmlHandler handler = new XmlHandler(Server.MapPath(xmlPath));
        DataTable tab = new DataTable();
        tab = handler.GetDataItemByName(fileName);
        lvwPageList.DataSource = tab;
        lvwPageList.DataBind();
    }
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal" style=""><span class="GramE">Step 5.</span> Build the application and you can debug it.</p>
<p class="MsoNormal" style=""><a href="http://msdn.microsoft.com/en-us/library/system.xml.linq.xdocument.aspx">MSDN:
<span class="SpellE">XDocument</span> Class</a></p>
<p class="MsoNormal" style=""><a href="http://msdn.microsoft.com/en-us/library/h0hfz6fc(v=VS.71).aspx">MSDN: &lt;<span class="SpellE">customErrors</span>&gt; Element</a></p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="description/95e3bc78-76ea-4f7c-8b0e-445ca740f249image.png">
</a></div>

</div>


    </div>
</body>
</html>
