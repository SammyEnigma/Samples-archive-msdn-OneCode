# Win7 trigger-start Windows service demo (CSWin7TriggerStartService)
## Requires
* Visual Studio 2010
## License
* MS-LPL
## Technologies
* Windows 7
## Topics
* Windows Service
* Windows 7
## IsPublished
* True
## ModifiedDate
* 2012-08-20 01:30:30
## Description

<h1>Win7 trigger-start Windows service demo (CSWin7TriggerStartService)</h1>
<h2>Introduction</h2>
<p class="MsoNormal">Services and background processes have tremendous influence on the overall performance of the system. If we could just cut down on the total number of services, we would reduce the total power consumption and increase the overall stability
 of the system. The Windows 7 Service Control Manager has been extended so that a service can be automatically started and stopped when a specific system event, or trigger, occurs on the system. The new mechanism is called Service Trigger Event. A service can
 register to be started or stopped when a trigger event occurs. This enables services to start when needed instead of starting automatically whether or not there is work to do. Examples of predefined trigger events include arrival of a device of a specified
 device interface class or availability of a particular firewall port. A service can also register for a custom trigger event generated by an Event Tracing for Windows (ETW) provider.<span style="">
</span></p>
<p class="MsoNormal">This Visual C# code sample shows how to create a trigger-start service that starts when a generic USB disk becomes available. The sample also shows how to create a trigger-start service that starts a service when the first IP address
 on the TCP/IP networking stack becomes available, and stops a service when the last IP address on the TCP/IP networking stack becomes unavailable. These start and stop events are reported in the Application log.<span style="">
</span></p>
<h2>Running the Sample<span style=""> </span></h2>
<p class="MsoNormal"><span style=""></span></p>
<p class="MsoNormal"><span style="">You must run this code sample on a Windows Server 2008 R2 or Windows 7-based computer. Service trigger events are not supported until Windows Server 2008 R2 and Windows 7.
</span></p>
<p class="MsoNormal"><span style=""></span></p>
<p class="MsoListParagraphCxSpFirst" style="text-indent:5.0pt"><span style=""><span style="">A.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Demonstration of the trigger start service sample that starts when a generic USB disk becomes available
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">1.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Build the project. </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">After build, you will get a service application: CSWin7TriggerStartService.exe.
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">2.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Install Windows Service. </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">Run Visual Studio 2010 Command Prompt as administrator, navigate to the output folder of the sample project, and enter the following command to install the service:<span style="">&nbsp;
</span><b style=""><u>InstallUtil.exe CSWin7TriggerStartService.exe</u> </b></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">The service is successfully installed if the process outputs:
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><i style=""><span style=""><span style="">&nbsp;
</span><span class="GramE">Beginning the Install phase of the installation.</span>
</span></i></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><i style=""><span style=""><span style="">&nbsp;
</span>...... </span></i></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><i style=""><span style=""><span style="">&nbsp;
</span>Installing service CSWin7TriggerStartService... </span></i></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><i style=""><span style=""><span style="">&nbsp;
</span>Service CSWin7TriggerStartService has been successfully installed. </span>
</i></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><i style=""><span style=""><span style="">&nbsp;
</span>Creating <span class="SpellE">EventLog</span> source CSWin7TriggerStartService in log Application...
</span></i></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><i style=""><span style=""><span style="">&nbsp;
</span>Configuring trigger-start service... </span></i></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><i style=""><span style=""><span style="">&nbsp;
</span>The Install phase completed successfully, and the Commit phase is beginning.
</span></i></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><i style=""><span style=""><span style="">&nbsp;
</span>...... </span></i></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><i style=""><span style=""><span style="">&nbsp;
</span>The Commit phase completed successfully. </span></i></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><i style=""><span style=""><span style="">&nbsp;
</span>The transacted install has completed. </span></i></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">And then pen Service Management Console (<span class="SpellE">services.msc</span>). You should be able to find &quot;CSWin7TriggerStartService Sample Service&quot; in the service
 list. </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""><img src="/site/view/file/64978/1/image.png" alt="" width="576" height="21" align="middle">
</span><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">3.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Trigger the service. </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">Plug in a generic USB disk to the computer, and refresh the service status in Service Management Console after a short while. You would find that CSWin7TriggerStartService Sample
 Service is trigger-started. </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""><img src="/site/view/file/64979/1/image.png" alt="" width="578" height="66" align="middle">
</span><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">4.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Clean up </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">Run following command to uninstall the service.
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><b style=""><u><span style="">Installutil.exe /u CSWin7TriggerStartService.exe
</span></u></b></p>
<p class="MsoListParagraphCxSpMiddle"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="text-indent:5.0pt"><span style=""><span style="">B.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Demonstration a trigger-start service that starts a service when the first IP address on the TCP/IP networking stack becomes available, and stops a service when the last IP address on the TCP/IP networking stack becomes unavailable.
</span></p>
<p class="MsoListParagraphCxSpMiddle"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">1.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Modify the source and rebuild. </span></p>
<p class="MsoListParagraphCxSpLast" style="margin-left:54.0pt"><span style="">In
<span class="SpellE">ProjectInstall.cs</span>, comment out the codes: </span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
ServiceTriggerStart.SetServiceTriggerStartOnUSBArrival(
    this.serviceInstaller1.ServiceName);

</pre>
<pre id="codePreview" class="csharp">
ServiceTriggerStart.SetServiceTriggerStartOnUSBArrival(
    this.serviceInstaller1.ServiceName);

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoListParagraph" style="margin-left:54.0pt"><span class="GramE"><span style="">and</span></span><span style=""> uncomment the following codes:
</span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
ServiceTriggerStart.SetServiceTriggerStartOnIPAddressArrival(
    this.serviceInstaller1.ServiceName);

</pre>
<pre id="codePreview" class="csharp">
ServiceTriggerStart.SetServiceTriggerStartOnIPAddressArrival(
    this.serviceInstaller1.ServiceName);

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoListParagraphCxSpFirst" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">2.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Redo the A.2 step to install the service. </span>
</p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">3.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Trigger the service. </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">Disconnect the computer from network. Make sure that the CSWin7TriggerStartService service is stopped at the moment. Plug in your network cable and refresh the service status
 in Service Management Console after the network is connected. You should find that the service is trigger-started. Next, unplug the network cable from your computer. You would see that the service is trigger-stopped in the meantime the network is disconnected.
</span></p>
<p class="MsoListParagraphCxSpMiddle"><span style=""></span></p>
<p class="MsoListParagraphCxSpLast" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">4.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Redo the A.4 step to uninstall the service </span>
</p>
<h2>Using the Code</h2>
<p class="MsoListParagraphCxSpFirst" style="text-indent:5.0pt"><span style=""><span style="">A.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Creation </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">1.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Follow the steps in <a href="http://msdn.microsoft.com/en-us/library/9k985bc9.aspx">
http://msdn.microsoft.com/en-us/library/9k985bc9.aspx</a> to create a Windows Service Project named CSWin7TriggerStartService.
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">2.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Rename the default Service1 to the generic name &quot;Service&quot;. Open the service in designer and set the
<span class="SpellE"><b style="">ServiceName</b></span> property to be CSWin7TriggerStartService.
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">3.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Drag and drop an event log component from toolbox to the design view of the service, and set its Log property to be Application, and its Source to be CSWin7TriggerStartService. The event log component will be used to log
 some application messages in the <span class="SpellE"><b style="">OnStart</b></span> and
<span class="SpellE"><b style="">OnStop</b></span> functions of the service: </span>
</p>
<p class="MsoListParagraphCxSpLast" style="margin-left:54.0pt"><span style=""></span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
protected override void OnStart(string[] args)
{
    this.eventLog1.WriteEntry(&quot;CSWin7TriggerStartService is in OnStart.&quot;);
}


protected override void OnStop()
{
    this.eventLog1.WriteEntry(&quot;CSWin7TriggerStartService is in OnStop.&quot;);
}

</pre>
<pre id="codePreview" class="csharp">
protected override void OnStart(string[] args)
{
    this.eventLog1.WriteEntry(&quot;CSWin7TriggerStartService is in OnStart.&quot;);
}


protected override void OnStop()
{
    this.eventLog1.WriteEntry(&quot;CSWin7TriggerStartService is in OnStop.&quot;);
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoListParagraphCxSpFirst" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">4.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Right-click in the design <span class="GramE">
view</span> of the service, and select Add Installer on the context menu. This creates the project installer components:
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">serviceProcessInstaller1
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">serviceInstaller1
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">Set the Account property of serviceProcessInstaller1 to be Local Service, so the service will be run as Local Service. As for serviceInstaller1, make its
<span class="SpellE"><b style="">ServiceName</b></span> property &quot;CSWin7TriggerStartService&quot;, and make its
<span class="SpellE"><b style="">DisplayName</b></span> &quot;CSWin7TriggerStartService Sample Service&quot;. Keep everything else the default value.
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="text-indent:5.0pt"><span style=""><span style="">B.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Adding P/Invoke signatures for native APIs and
<span class="SpellE">structs</span> related to SCM </span></p>
<p class="MsoListParagraphCxSpMiddle"><span style="">Add a <span class="SpellE">
NativeMethods.cs</span> file and define P/Invoke signatures for native APIs like <b style="">
ChangeServiceConfig2</b>, <b style="">QueryServiceConfig2</b> and the related <span class="SpellE">
structs</span> and enumerations. </span></p>
<p class="MsoListParagraphCxSpMiddle"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="text-indent:5.0pt"><span style=""><span style="">C.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Configuring the service to trigger-start when a generic USB disk becomes available (or trigger-start when the first IP address becomes
<span class="GramE">available,</span> and trigger-stop when the last IP address becomes unavailable.)
</span></p>
<p class="MsoListParagraphCxSpMiddle"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle"><span style="">Services can be registered as trigger-start from the sc.exe command line utility (using the
<span class="SpellE">sc</span> <span class="SpellE">triggerinfo</span> command and need to run the Command Shell as Administrator), or using the
<b style="">ChangeServiceConfig2</b> API programmatically. The service installer utility of .NET Windows Services (<span class="SpellE"><b style="">InstallUtil</b></span>) does not support
<span class="SpellE">triggerinfo</span> switch, so we do it programmatically. <span class="SpellE">
<span class="GramE">ServiceInstaller's</span></span><span class="GramE"><span style="">&nbsp;
</span><span class="SpellE">AfterInstall</span></span> event allows us to execute some codes after the
<span class="SpellE">serivce</span> is installed. We are going to register the service as trigger-start in this event handler.
</span></p>
<p class="MsoListParagraphCxSpMiddle"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">1.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Add the helper class <span class="SpellE">ServiceTriggerStart.cs</span> to wrap and exposes some useful functions related to trigger start service.
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<table class="MsoTableGrid" border="1" cellspacing="0" cellpadding="0" style="margin-left:54.0pt; border-collapse:collapse; border:none">
<tbody>
<tr style="">
<td width="387" valign="top" style="width:290.55pt; border:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt">
<p class="MsoListParagraphCxSpLast" style="margin-left:0cm"><span class="SpellE"><span style="">ServiceTriggerStart.IsSupported</span></span><span style="">
</span></p>
</td>
<td width="483" valign="top" style="width:362.1pt; border:solid windowtext 1.0pt; border-left:none; padding:0cm 5.4pt 0cm 5.4pt">
<p class="MsoNormal"><span style="">Check whether the current system supports service trigger start. Service trigger events are not supported until Windows Server 2008 R2 and Windows 7. Windows Server 2008 R2 and Windows 7 have major version 6 and minor version
 1. </span></p>
</td>
</tr>
<tr style="">
<td width="387" valign="top" style="width:290.55pt; border:solid windowtext 1.0pt; border-top:none; padding:0cm 5.4pt 0cm 5.4pt">
<p class="MsoListParagraphCxSpFirst" style="margin-left:0cm"><span class="SpellE"><span style="">ServiceTriggerStart.IsTriggerStartService</span></span><span style="">
</span></p>
</td>
<td width="483" valign="top" style="width:362.1pt; border-top:none; border-left:none; border-bottom:solid windowtext 1.0pt; border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt">
<p class="MsoListParagraphCxSpLast" style="margin-left:0cm"><span style="">Determine whether the specified service is configured to trigger start.
</span></p>
</td>
</tr>
<tr style="">
<td width="387" valign="top" style="width:290.55pt; border:solid windowtext 1.0pt; border-top:none; padding:0cm 5.4pt 0cm 5.4pt">
<p class="MsoListParagraph" style="margin-left:0cm"><span class="SpellE"><span style="">ServiceTriggerStart.SetServiceTriggerStartOnUSBArrival</span></span><span style="">
</span></p>
</td>
<td width="483" valign="top" style="width:362.1pt; border-top:none; border-left:none; border-bottom:solid windowtext 1.0pt; border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt">
<p class="MsoNormal"><span style="">Set the service to trigger-start when a generic USB disk becomes available.
</span></p>
</td>
</tr>
<tr style="">
<td width="387" valign="top" style="width:290.55pt; border:solid windowtext 1.0pt; border-top:none; padding:0cm 5.4pt 0cm 5.4pt">
<p class="MsoListParagraph" style="margin-left:0cm"><span class="SpellE"><span style="">ServiceTriggerStart.SetServiceTriggerStartOnIPAddressArrival</span></span><span style="">
</span></p>
</td>
<td width="483" valign="top" style="width:362.1pt; border-top:none; border-left:none; border-bottom:solid windowtext 1.0pt; border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt">
<p class="MsoNormal"><span style="">Set the service to trigger-start when the first IP address on the TCP/IP networking stack becomes available, and trigger-stop when the last IP address on the TCP/IP networking stack becomes unavailable.
</span></p>
</td>
</tr>
</tbody>
</table>
<p class="MsoListParagraphCxSpFirst" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">Take
<span class="SpellE"><b style="">SetServiceTriggerStartOnUSBArrival</b></span> as an example. The function modifies service configuration by calling the Win32 API
<b style="">ChangeServiceConfig2</b> to set service trigger start on USB arrival.
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:72.0pt; text-indent:5.0pt">
<span style=""><span style="">a.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Allocate a SERVICE_TRIGGER_SPECIFIC_DATA_ITEM structure
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:90.0pt; text-indent:5.0pt">
<span style=""><span style=""><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>i.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Set its <span class="SpellE">dwDataType</span> member to SERVICE_TRIGGER_DATA_TYPE_STRING
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:90.0pt; text-indent:5.0pt">
<span style=""><span style=""><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>ii.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Set its <span class="SpellE">cbData</span> member to the length of the string L&quot;USBSTOR\\<span class="SpellE">GenDisk</span>&quot; in bytes
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:90.0pt; text-indent:5.0pt">
<span style=""><span style=""><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iii.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Set its <span class="SpellE">pData</span> member to that string.
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:90.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:72.0pt; text-indent:5.0pt">
<span style=""><span style="">b.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Allocate a SERVICE_TRIGGER structure </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:90.0pt; text-indent:5.0pt">
<span style=""><span style=""><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>i.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Set its <span class="SpellE">dwTriggerType</span> member to<span style="">&nbsp;
</span>SERVICE_TRIGGER_TYPE_DEVICE_INTERFACE_ARRIVAL </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:90.0pt; text-indent:5.0pt">
<span style=""><span style=""><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>ii.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Set its <span class="SpellE">dwAction</span> member to SERVICE_TRIGGER_ACTION_SERVICE_START
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:90.0pt; text-indent:5.0pt">
<span style=""><span style=""><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iii.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Set its <span class="SpellE">pTriggerSubtype</span> member to the address of the<span style="">&nbsp;&nbsp;
</span>GUID_DEVINTERFACE_DISK GUID </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:90.0pt; text-indent:5.0pt">
<span style=""><span style=""><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iv.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Set its <span class="SpellE">cDataItems</span> member to 1 and its
<span class="SpellE">pDataItems</span> member to the address of the structure allocated in the previous step.
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:90.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:72.0pt; text-indent:5.0pt">
<span style=""><span style="">c.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Allocate a SERVICE_TRIGGER_INFO structure </span>
</p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:72.0pt"><span style="">Set its
<span class="SpellE">cTriggers</span> member to 1 and its <span class="SpellE">
pTriggers</span> member to the address<span style="">&nbsp;&nbsp;&nbsp; </span>of the structure allocated in the previous step.
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:72.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:72.0pt; text-indent:5.0pt">
<span style=""><span style="">d.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Call the ChangeServiceConfig2 function with <span class="GramE">
the<b style=""><span style="">&nbsp; </span>SERVICE</b></span><b style="">_CONFIG_TRIGGER_INFO</b> information level and pass to it the address<span style="">&nbsp;
</span>of the structure allocated in the previous step. </span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">Please note that the above data structures are initially allocated on managed heap. We need to marshal them to the native memory by calling
<span class="SpellE">Marshal.AllocHGlobal</span> and <span class="SpellE">Marshal.StructureToPtr</span>, and free the native memory after use (<span class="SpellE">Marshal.FreeHGlobal</span>).
</span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">The complete code of setting service
<span class="SpellE">tigger</span> start on USB arrival is: </span></p>
<p class="MsoListParagraphCxSpLast" style="margin-left:54.0pt"><span style=""></span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
IntPtr pGuidUSBDevice = IntPtr.Zero;
IntPtr pUSBHardwareId = IntPtr.Zero;
IntPtr pDeviceData = IntPtr.Zero;
IntPtr pServiceTrigger = IntPtr.Zero;
IntPtr pServiceTriggerInfo = IntPtr.Zero;


try
{
    // Marshal the Guid struct GUID_DEVINTERFACE_DISK to native memory


    pGuidUSBDevice = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(Guid)));
    Marshal.StructureToPtr(GUID_DEVINTERFACE_DISK, pGuidUSBDevice, false);


    // Allocate and set the SERVICE_TRIGGER_SPECIFIC_DATA_ITEM structure


    SERVICE_TRIGGER_SPECIFIC_DATA_ITEM deviceData;
    deviceData.dwDataType =
        ServiceTriggerDataType.SERVICE_TRIGGER_DATA_TYPE_STRING;
    deviceData.cbData = (uint)(USBHardwareId.Length &#43; 1) * 2;
    pUSBHardwareId = Marshal.StringToHGlobalUni(USBHardwareId);
    deviceData.pData = pUSBHardwareId;


    // Marshal SERVICE_TRIGGER_SPECIFIC_DATA_ITEM to native memory


    int cbDataItem = Marshal.SizeOf(typeof(SERVICE_TRIGGER_SPECIFIC_DATA_ITEM));
    pDeviceData = Marshal.AllocHGlobal(cbDataItem);
    Marshal.StructureToPtr(deviceData, pDeviceData, false);


    // Allocate and set the SERVICE_TRIGGER structure


    SERVICE_TRIGGER serviceTrigger = new SERVICE_TRIGGER();
    serviceTrigger.dwTriggerType =
        ServiceTriggerType.SERVICE_TRIGGER_TYPE_DEVICE_INTERFACE_ARRIVAL;
    serviceTrigger.dwAction =
        ServiceTriggerAction.SERVICE_TRIGGER_ACTION_SERVICE_START;
    serviceTrigger.pTriggerSubtype = pGuidUSBDevice;
    serviceTrigger.cDataItems = 1;
    serviceTrigger.pDataItems = pDeviceData;


    // Marshal the SERVICE_TRIGGER struct to native memory


    int cbServiceTrigger = Marshal.SizeOf(typeof(SERVICE_TRIGGER));
    pServiceTrigger = Marshal.AllocHGlobal(cbServiceTrigger);
    Marshal.StructureToPtr(serviceTrigger, pServiceTrigger, false);


    // Allocate and set the SERVICE_TRIGGER_INFO structure


    SERVICE_TRIGGER_INFO serviceTriggerInfo = new SERVICE_TRIGGER_INFO();
    serviceTriggerInfo.cTriggers = 1;
    serviceTriggerInfo.pTriggers = pServiceTrigger;


    // Marshal the SERVICE_TRIGGER_INFO struct to native memory


    int cbServiceTriggerInfo = Marshal.SizeOf(typeof(SERVICE_TRIGGER_INFO));
    pServiceTriggerInfo = Marshal.AllocHGlobal(cbServiceTriggerInfo);
    Marshal.StructureToPtr(serviceTriggerInfo, pServiceTriggerInfo, false);


    // Call ChangeServiceConfig2 with the SERVICE_CONFIG_TRIGGER_INFO level 
    // and pass to it the address of the SERVICE_TRIGGER_INFO structure


    if (!NativeMethods.ChangeServiceConfig2(hService,
        ServiceConfig2InfoLevel.SERVICE_CONFIG_TRIGGER_INFO,
        pServiceTriggerInfo))
    {
        // If the handle is invalid, get the last Win32 error and throw a 
        // Win32Exception
        Marshal.ThrowExceptionForHR(Marshal.GetHRForLastWin32Error());
    }
}
finally
{
    // Clean up the native memory


    if (pGuidUSBDevice != IntPtr.Zero)
    {
        Marshal.FreeHGlobal(pGuidUSBDevice);
    }


    if (pUSBHardwareId != IntPtr.Zero)
    {
        Marshal.FreeHGlobal(pUSBHardwareId);
    }


    if (pDeviceData != IntPtr.Zero)
    {
        Marshal.FreeHGlobal(pDeviceData);
    }


    if (pServiceTrigger != IntPtr.Zero)
    {
        Marshal.FreeHGlobal(pServiceTrigger);
    }


    if (pServiceTriggerInfo != IntPtr.Zero)
    {
        Marshal.FreeHGlobal(pServiceTriggerInfo);
    }
}

</pre>
<pre id="codePreview" class="csharp">
IntPtr pGuidUSBDevice = IntPtr.Zero;
IntPtr pUSBHardwareId = IntPtr.Zero;
IntPtr pDeviceData = IntPtr.Zero;
IntPtr pServiceTrigger = IntPtr.Zero;
IntPtr pServiceTriggerInfo = IntPtr.Zero;


try
{
    // Marshal the Guid struct GUID_DEVINTERFACE_DISK to native memory


    pGuidUSBDevice = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(Guid)));
    Marshal.StructureToPtr(GUID_DEVINTERFACE_DISK, pGuidUSBDevice, false);


    // Allocate and set the SERVICE_TRIGGER_SPECIFIC_DATA_ITEM structure


    SERVICE_TRIGGER_SPECIFIC_DATA_ITEM deviceData;
    deviceData.dwDataType =
        ServiceTriggerDataType.SERVICE_TRIGGER_DATA_TYPE_STRING;
    deviceData.cbData = (uint)(USBHardwareId.Length &#43; 1) * 2;
    pUSBHardwareId = Marshal.StringToHGlobalUni(USBHardwareId);
    deviceData.pData = pUSBHardwareId;


    // Marshal SERVICE_TRIGGER_SPECIFIC_DATA_ITEM to native memory


    int cbDataItem = Marshal.SizeOf(typeof(SERVICE_TRIGGER_SPECIFIC_DATA_ITEM));
    pDeviceData = Marshal.AllocHGlobal(cbDataItem);
    Marshal.StructureToPtr(deviceData, pDeviceData, false);


    // Allocate and set the SERVICE_TRIGGER structure


    SERVICE_TRIGGER serviceTrigger = new SERVICE_TRIGGER();
    serviceTrigger.dwTriggerType =
        ServiceTriggerType.SERVICE_TRIGGER_TYPE_DEVICE_INTERFACE_ARRIVAL;
    serviceTrigger.dwAction =
        ServiceTriggerAction.SERVICE_TRIGGER_ACTION_SERVICE_START;
    serviceTrigger.pTriggerSubtype = pGuidUSBDevice;
    serviceTrigger.cDataItems = 1;
    serviceTrigger.pDataItems = pDeviceData;


    // Marshal the SERVICE_TRIGGER struct to native memory


    int cbServiceTrigger = Marshal.SizeOf(typeof(SERVICE_TRIGGER));
    pServiceTrigger = Marshal.AllocHGlobal(cbServiceTrigger);
    Marshal.StructureToPtr(serviceTrigger, pServiceTrigger, false);


    // Allocate and set the SERVICE_TRIGGER_INFO structure


    SERVICE_TRIGGER_INFO serviceTriggerInfo = new SERVICE_TRIGGER_INFO();
    serviceTriggerInfo.cTriggers = 1;
    serviceTriggerInfo.pTriggers = pServiceTrigger;


    // Marshal the SERVICE_TRIGGER_INFO struct to native memory


    int cbServiceTriggerInfo = Marshal.SizeOf(typeof(SERVICE_TRIGGER_INFO));
    pServiceTriggerInfo = Marshal.AllocHGlobal(cbServiceTriggerInfo);
    Marshal.StructureToPtr(serviceTriggerInfo, pServiceTriggerInfo, false);


    // Call ChangeServiceConfig2 with the SERVICE_CONFIG_TRIGGER_INFO level 
    // and pass to it the address of the SERVICE_TRIGGER_INFO structure


    if (!NativeMethods.ChangeServiceConfig2(hService,
        ServiceConfig2InfoLevel.SERVICE_CONFIG_TRIGGER_INFO,
        pServiceTriggerInfo))
    {
        // If the handle is invalid, get the last Win32 error and throw a 
        // Win32Exception
        Marshal.ThrowExceptionForHR(Marshal.GetHRForLastWin32Error());
    }
}
finally
{
    // Clean up the native memory


    if (pGuidUSBDevice != IntPtr.Zero)
    {
        Marshal.FreeHGlobal(pGuidUSBDevice);
    }


    if (pUSBHardwareId != IntPtr.Zero)
    {
        Marshal.FreeHGlobal(pUSBHardwareId);
    }


    if (pDeviceData != IntPtr.Zero)
    {
        Marshal.FreeHGlobal(pDeviceData);
    }


    if (pServiceTrigger != IntPtr.Zero)
    {
        Marshal.FreeHGlobal(pServiceTrigger);
    }


    if (pServiceTriggerInfo != IntPtr.Zero)
    {
        Marshal.FreeHGlobal(pServiceTriggerInfo);
    }
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoListParagraphCxSpFirst" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpLast" style="margin-left:54.0pt"><span style="">Please note that, in the above code, the service handle (<span class="SpellE">schService</span>) must be opened or created with the SERVICE_CHANGE_CONFIG access permission:
</span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
SafeServiceHandle schService = NativeMethods.OpenService(schSCManager,
    serviceName, ServiceAccessRights.SERVICE_CHANGE_CONFIG);

</pre>
<pre id="codePreview" class="csharp">
SafeServiceHandle schService = NativeMethods.OpenService(schSCManager,
    serviceName, ServiceAccessRights.SERVICE_CHANGE_CONFIG);

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoListParagraphCxSpFirst" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpLast" style="margin-left:54.0pt; text-indent:5.0pt">
<span style=""><span style="">2.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="">Add the <span class="SpellE">AfterInstall</span> event handler of serviceInstaller1.
</span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
private void serviceInstaller1_AfterInstall(object sender, 
    InstallEventArgs e)
{
}

</pre>
<pre id="codePreview" class="csharp">
private void serviceInstaller1_AfterInstall(object sender, 
    InstallEventArgs e)
{
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoListParagraphCxSpFirst" style="margin-left:54.0pt"><span style=""></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin-left:54.0pt"><span style="">In the event handler, determine if the current operating system supports service trigger events (<span class="SpellE">ServiceTriggerStart.IsSupported</span>), and configure
 the service to trigger start if applicable. (<span class="SpellE">ServiceTriggerStart.SetServiceTriggerStartOnUSBArrival</span> /
<span class="SpellE">ServiceTriggerStart.SetServiceTriggerStartOnIPAddressArrival</span>)
</span></p>
<p class="MsoListParagraphCxSpLast" style="margin-left:54.0pt"><span style=""></span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
if (ServiceTriggerStart.IsSupported)
{
    ServiceTriggerStart.SetServiceTriggerStartOnUSBArrival(
        this.serviceInstaller1.ServiceName);
    // [-or-]
    //ServiceTriggerStart.SetServiceTriggerStartOnIPAddressArrival(
    //    this.serviceInstaller1.ServiceName);
}

</pre>
<pre id="codePreview" class="csharp">
if (ServiceTriggerStart.IsSupported)
{
    ServiceTriggerStart.SetServiceTriggerStartOnUSBArrival(
        this.serviceInstaller1.ServiceName);
    // [-or-]
    //ServiceTriggerStart.SetServiceTriggerStartOnIPAddressArrival(
    //    this.serviceInstaller1.ServiceName);
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal"><span style=""></span></p>
<h2>More Information</h2>
<p class="MsoListParagraphCxSpFirst" style="text-indent:5.0pt"><a href="http://msdn.microsoft.com/en-us/library/dd405513(VS.85).aspx">MSDN: Service Trigger Events</a></p>
<p class="MsoListParagraphCxSpMiddle" style="text-indent:5.0pt"><a href="http://www.microsoft.com/downloads/details.aspx?familyid=1C333F06-FADB-4D93-9C80-402621C600E7&displaylang=en">Windows 7 Training Kit For Developers</a></p>
<p class="MsoListParagraphCxSpLast" style="text-indent:5.0pt"><a href="http://support.microsoft.com/kb/975425/en-us">KB: How to create a trigger-start Windows service in Windows 7</a>
</p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="http://bit.ly/onecodelogo">
</a></div>
