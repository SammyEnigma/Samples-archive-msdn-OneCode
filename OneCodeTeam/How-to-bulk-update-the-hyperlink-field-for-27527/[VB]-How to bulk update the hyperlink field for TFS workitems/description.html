<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/a7bd86db-8a7a-43ce-8954-21f8f839f51bCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>How to bulk update the hyperlink field for TFS workitems</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>How to bulk update the hyperlink field for TFS workitems</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            .NET Development, Development Tools, Team Foundation Server (TFS), Team Foundation Server 2012, Team Foundation Server Extensibility
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            TFS2012
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">3/3/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/How-to-bulk-update-the-9b359157">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<hr>
<div><a href="http://blogs.msdn.com/b/onecode" style="margin-top:3px"><img alt="" src="description/8171.onecodesampletopbanner.png">
</a></div>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:24pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:14pt"><span style="font-weight:bold; font-size:14pt">How to bulk update the hyperlink field for TFS workitems using VB.NET</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt">Introduction</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">Currently</span><span style="font-size:11pt"> there is no direct way to update the hyperlink field in
</span><span style="font-size:11pt">workitems and customer</span><span style="font-size:11pt">s</span><span style="font-size:11pt"> had to update this field for thousand</span><span style="font-size:11pt">s</span><span style="font-size:11pt"> of
</span><span style="font-size:11pt">workitems. To avoid </span><span style="font-size:11pt">manual</span><span style="font-size:11pt"> update</span><span style="font-size:11pt">s</span><span style="font-size:11pt">, we can write an application using TFS</span><span style="font-size:11pt">.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt">Running the Sample</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">Build the solution and run the console application by passing the collection information along with old information about hyperlink and new information about hyperlink to update.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt">Using the Code</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">The following code snippet shows how to bulk update the hyperlink field for TFS workitems programmatically.</span></span>
</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">vb</span>
<pre class="hidden">
Public Shared Sub Main(args As String())
    ' Get the Uri to the project collection to use
    Dim collectionUri = UpdateHyperLink.Helper.GetCollectionUri(args)
    ' Get the old server information and new server information for replacing
    Dim oldText As String = args(1)
    Dim newText As String = args(2)
    Try
        ' Get the work item store from the TeamFoundationServer
        Console.WriteLine(&quot;Connecting to {0}...&quot;, collectionUri)
        ' Get a reference to the team project collection
        Using projectCollection = TfsTeamProjectCollectionFactory.GetTeamProjectCollection(collectionUri)
            ' Get a reference to the work item tracking service
            Dim workItemStore = projectCollection.GetService(Of WorkItemStore)()
            If workItemStore.Projects.Count &lt;= 0 Then
                Throw New ApplicationException(&quot;There are no projects in this server&quot;)
            End If
            Dim hyperWic As WorkItemCollection = workItemStore.Query(&quot;select [system.id] from workitems where [System.HyperLinkCount] &gt; 0&quot;)
            For Each wi As WorkItem In hyperWic
                'Copy the references to the links to another collection, enumerate over that collection, do your remove and add to the wi.Links collection.
                Dim tempForEmenuration As New List(Of LinkCollection)()
                For Each link As Link In wi.Links
                    If link.BaseType = BaseLinkType.Hyperlink Then
                        tempForEmenuration.Add(wi.Links)
                    End If
                Next
                For Each temp As LinkCollection In tempForEmenuration
                    For Each tempLink As Link In temp
                        Dim hyper As Hyperlink = DirectCast(tempLink, Hyperlink)
                        If hyper.Location.Contains(oldText) Then
                            Dim comment As String = hyper.Comment
                            Dim newLinkAfterChange As String = hyper.Location.Replace(oldText, newText)
                            temp.Remove(tempLink)
                            Dim newHyper As New Hyperlink(newLinkAfterChange)
                            newHyper.Comment = comment
                            wi.Links.Add(newHyper)
                            wi.Save()
                            Exit For
                        End If
                    Next
                Next
            Next
        End Using
    Catch e As Exception
        Console.WriteLine(&quot;Error: {0}&quot;, e.StackTrace)
    End Try
End Sub
</pre>
<pre id="codePreview" class="vb">
Public Shared Sub Main(args As String())
    ' Get the Uri to the project collection to use
    Dim collectionUri = UpdateHyperLink.Helper.GetCollectionUri(args)
    ' Get the old server information and new server information for replacing
    Dim oldText As String = args(1)
    Dim newText As String = args(2)
    Try
        ' Get the work item store from the TeamFoundationServer
        Console.WriteLine(&quot;Connecting to {0}...&quot;, collectionUri)
        ' Get a reference to the team project collection
        Using projectCollection = TfsTeamProjectCollectionFactory.GetTeamProjectCollection(collectionUri)
            ' Get a reference to the work item tracking service
            Dim workItemStore = projectCollection.GetService(Of WorkItemStore)()
            If workItemStore.Projects.Count &lt;= 0 Then
                Throw New ApplicationException(&quot;There are no projects in this server&quot;)
            End If
            Dim hyperWic As WorkItemCollection = workItemStore.Query(&quot;select [system.id] from workitems where [System.HyperLinkCount] &gt; 0&quot;)
            For Each wi As WorkItem In hyperWic
                'Copy the references to the links to another collection, enumerate over that collection, do your remove and add to the wi.Links collection.
                Dim tempForEmenuration As New List(Of LinkCollection)()
                For Each link As Link In wi.Links
                    If link.BaseType = BaseLinkType.Hyperlink Then
                        tempForEmenuration.Add(wi.Links)
                    End If
                Next
                For Each temp As LinkCollection In tempForEmenuration
                    For Each tempLink As Link In temp
                        Dim hyper As Hyperlink = DirectCast(tempLink, Hyperlink)
                        If hyper.Location.Contains(oldText) Then
                            Dim comment As String = hyper.Comment
                            Dim newLinkAfterChange As String = hyper.Location.Replace(oldText, newText)
                            temp.Remove(tempLink)
                            Dim newHyper As New Hyperlink(newLinkAfterChange)
                            newHyper.Comment = comment
                            wi.Links.Add(newHyper)
                            wi.Save()
                            Exit For
                        End If
                    Next
                Next
            Next
        End Using
    Catch e As Exception
        Console.WriteLine(&quot;Error: {0}&quot;, e.StackTrace)
    End Try
End Sub
</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt"></span><span style="font-weight:bold; font-size:13pt">More Information</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">TeamFoundationServer </span>
<span style="font-size:11pt">Class</span></span> </p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt"></span><a href="http://msdn.microsoft.com/en-us/library/microsoft.teamfoundation.client.teamfoundationserver.aspx" style="text-decoration:none"><span style="color:#0563C1; font-size:11pt; text-decoration:underline">http://msdn.microsoft.com/en-us/library/microsoft.teamfoundation.client.teamfoundationserver.aspx</span></a><span style="font-size:11pt">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">TfsTeamProjectCollectionFactory Class</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt"></span><a href="http://msdn.microsoft.com/en-us/library/microsoft.teamfoundation.client.tfsteamprojectcollectionfactory.aspx" style="text-decoration:none"><span style="color:#0563C1; font-size:11pt; text-decoration:underline">http://msdn.microsoft.com/en-us/library/microsoft.teamfoundation.client.tfsteamprojectcollectionfactory.aspx</span></a><span style="font-size:11pt">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">WorkItemStore Class </span>
</span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><a href="http://msdn.microsoft.com/en-us/library/microsoft.teamfoundation.workitemtracking.client.workitemstore.aspx" style="text-decoration:none"><span style="color:#0563C1; font-size:11pt; text-decoration:underline">http://msdn.microsoft.com/en-us/library/microsoft.teamfoundation.workitemtracking.client.workitemstore.aspx</span></a><span style="font-size:11pt">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt">&nbsp;</span> </p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="description/adaa87bc-3ace-4da7-8848-07ab8276df38image.png">
</a></div>

</div>


    </div>
</body>
</html>
