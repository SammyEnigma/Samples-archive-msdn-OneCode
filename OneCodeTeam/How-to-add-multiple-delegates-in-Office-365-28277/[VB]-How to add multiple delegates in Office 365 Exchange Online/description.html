<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/a7bd86db-8a7a-43ce-8954-21f8f839f51bCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>How to add multiple delegates in Office 365 Exchange Online</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>How to add multiple delegates in Office 365 Exchange Online</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Exchange Online, Office 365
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Impersonation, Delegate
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">4/21/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/How-to-add-multiple-44542ae0">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<hr>
<div><a href="http://blogs.msdn.com/b/onecode" style="margin-top:3px"><img alt="" src="description/8171.onecodesampletopbanner.png">
</a></div>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:24pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:14pt"><span style="font-size:16pt">How to Add Delegates in Office 365 Exchange Online</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt">Introduction</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:12pt"></span><span style="font-size:12pt">Currently, you can easily add delegates in Outlook. But you
</span><span style="font-size:12pt">will </span><span style="font-size:12pt">find this feature is not available in Outlook Web App (OWA). In this application, we will demonstrate how to add multi delegates in Office 365 Exchange Online.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:12pt"></span><span style="font-size:12pt">1. Get the addresses of delegates;</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:12pt"></span><span style="font-size:12pt">2. Get the addresses of primary accounts;</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:12pt"></span><span style="font-size:12pt">3. Set the ImpersonatedUserId property if the login account has the impersonation permission.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:12pt"></span><span style="font-size:12pt">4. Add all the delegates into all the primary accounts.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt">Running the Sample</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">Press F5 to run the sample,</span><span style="font-size:11pt"> you will get</span><span style="font-size:11pt"> the following result.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">First, we use our account to connect</span><span style="font-size:11pt"> to</span><span style="font-size:11pt"> the Exchange Online.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt"><img src="description/image.png" alt="" width="407" height="55" align="middle">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">Then, we need the identities of the delegates.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt"><img src="description/307e2353-d9ea-403d-90d8-0a48c44bb3b7image.png" alt="" width="639" height="31" align="middle">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">And if we have the impersonation permission, we can add the delegates to multi accounts by set</span><span style="font-size:11pt">ting</span><span style="font-size:11pt"> the
</span><span style="font-size:12pt">ImpersonatedUserId property</span><span style="font-size:11pt">.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt"><img src="description/941ea583-4a30-4a03-a358-76c757eec191image.png" alt="" width="643" height="39" align="middle">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">The f</span><span style="font-size:11pt">ollowing is the result:</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt"><img src="description/65d6abef-b724-4e6a-8667-eb2ae7959e2eimage.png" alt="" width="649" height="139" align="middle">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">If we don&rsquo;t have the impersonation permission, we can directly press Enter to add the delegates to the login account.</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt">Using the Code</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-bottom:0pt; line-height:24pt; direction:ltr; unicode-bidi:normal; text-autospace:none">
<span style="font-size:11pt"><span style="font-size:11pt">Before we add the delegates,
</span><span style="font-size:11pt">w</span><span style="font-size:11pt">e need the addresses of the delegates.</span></span>
</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span><span class="hidden">vb</span>
<pre class="hidden">
Console.WriteLine(&quot;Please input the user identity(s) that were used as the delegates:&quot;);
 String delegateInfo = Console.ReadLine();
 // We get the addresses related to the identities of delegates.
 List&lt;String&gt; delegateIdentities = new List&lt;string&gt;();
 if (!String.IsNullOrWhiteSpace(delegateInfo))
 {
     // You can input the &quot;EXIT&quot; to exit.
     if (delegateInfo.ToUpper().CompareTo(&quot;EXIT&quot;) == 0)
     {
         return;
     }
     foreach (String delegateIdentity in delegateInfo.Split(','))
     {
         NameResolutionCollection nameResolutions =
    service.ResolveName(delegateIdentity, ResolveNameSearchLocation.DirectoryOnly, true);
         if (nameResolutions.Count != 1)
         {
             Console.WriteLine(&quot;{0} is invalid user identity as the delegate.&quot;,
                 delegateIdentity);
         }
         else
         {
             delegateIdentities.Add(nameResolutions[0].Mailbox.Address);
         }
     }
     if (delegateIdentities.Count == 0)
     {
         Console.WriteLine(&quot;There's not any valid user identity as the delegate.&quot;);
         continue;
     }
 }
 else
 {
     Console.WriteLine(&quot;The delegates cannot be null!&quot;);
     continue;
 }
</pre>
<pre class="hidden">
Console.WriteLine(&quot;Please input the user identity(s) that were used as the delegates:&quot;)
Dim delegateInfo As String = Console.ReadLine()
' We get the addresses related to the identities of delegates.
Dim delegateIdentities As New List(Of String)()
If Not String.IsNullOrWhiteSpace(delegateInfo) Then
    ' You can input the &quot;EXIT&quot; to exit.
    If delegateInfo.ToUpper().CompareTo(&quot;EXIT&quot;) = 0 Then
        Return
    End If
    For Each delegateIdentity As String In delegateInfo.Split(&quot;,&quot;c)
        Dim nameResolutions As NameResolutionCollection =
    service.ResolveName(delegateIdentity, ResolveNameSearchLocation.DirectoryOnly, True)
        If nameResolutions.Count &lt;&gt; 1 Then
            Console.WriteLine(&quot;{0} is invalid user identity as the delegate.&quot;,
                              delegateIdentity)
        Else
            delegateIdentities.Add(nameResolutions(0).Mailbox.Address)
        End If
    Next delegateIdentity
    If delegateIdentities.Count = 0 Then
        Console.WriteLine(&quot;There's not any valid user identity as the delegate.&quot;)
        Continue Do
    End If
Else
    Console.WriteLine(&quot;The delegates cannot be null!&quot;)
    Continue Do
End If
</pre>
<pre id="codePreview" class="csharp">
Console.WriteLine(&quot;Please input the user identity(s) that were used as the delegates:&quot;);
 String delegateInfo = Console.ReadLine();
 // We get the addresses related to the identities of delegates.
 List&lt;String&gt; delegateIdentities = new List&lt;string&gt;();
 if (!String.IsNullOrWhiteSpace(delegateInfo))
 {
     // You can input the &quot;EXIT&quot; to exit.
     if (delegateInfo.ToUpper().CompareTo(&quot;EXIT&quot;) == 0)
     {
         return;
     }
     foreach (String delegateIdentity in delegateInfo.Split(','))
     {
         NameResolutionCollection nameResolutions =
    service.ResolveName(delegateIdentity, ResolveNameSearchLocation.DirectoryOnly, true);
         if (nameResolutions.Count != 1)
         {
             Console.WriteLine(&quot;{0} is invalid user identity as the delegate.&quot;,
                 delegateIdentity);
         }
         else
         {
             delegateIdentities.Add(nameResolutions[0].Mailbox.Address);
         }
     }
     if (delegateIdentities.Count == 0)
     {
         Console.WriteLine(&quot;There's not any valid user identity as the delegate.&quot;);
         continue;
     }
 }
 else
 {
     Console.WriteLine(&quot;The delegates cannot be null!&quot;);
     continue;
 }
</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-bottom:0pt; line-height:24pt; direction:ltr; unicode-bidi:normal; text-autospace:none">
<span style="font-size:11pt"><span style="font-size:11pt"></span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-bottom:0pt; line-height:24pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">If we have impersonation permission, we can add the delegates to multi accounts by set</span><span style="font-size:11pt">ting</span><span style="font-size:11pt"> the
</span><span style="font-size:12pt">ImpersonatedUserId property</span><span style="font-size:11pt">.</span></span>
</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span><span class="hidden">vb</span>
<pre class="hidden">
Console.WriteLine(&quot;Please input the user identity you want to set the &quot; &#43;
    &quot;delegates(or you can directly press Enter to set delegates in current account):&quot;);
String primaryInfo = Console.ReadLine();
if (!String.IsNullOrWhiteSpace(primaryInfo))
{
    // You can input the &quot;EXIT&quot; to exit.
    if (primaryInfo.ToUpper().CompareTo(&quot;EXIT&quot;) == 0)
    {
        return;
    }
    String[] primaryIdentities = primaryInfo.Split(',');
    foreach (String primaryIdentity in primaryIdentities)
    {
        // If the user identity is valid, we will set it as the ImpersonatedUserId.
        NameResolutionCollection nameResolutions =
     service.ResolveName(primaryIdentity, ResolveNameSearchLocation.DirectoryOnly, true);
        if (nameResolutions.Count != 1)
        {
            Console.WriteLine(&quot;{0} is invalid user identity.&quot;, primaryIdentity);
        }
        else
        {
            String emailAddress = nameResolutions[0].Mailbox.Address;
            service.ImpersonatedUserId =
                new ImpersonatedUserId(ConnectingIdType.SmtpAddress, emailAddress);
foreach (String delegateIdentity in delegateIdentities)
                        {
                AddAccountDelegates(service, emailAddress, delegateIdentity, 
                    permissionLevelName, permissionLevel);
            }
        }
    }
}
</pre>
<pre class="hidden">
Console.WriteLine(&quot;Please input the user identity you want to set the &quot; &
            &quot;delegates(or you can directly press Enter to set delegates in current account):&quot;)
Dim primaryInfo As String = Console.ReadLine()
If Not String.IsNullOrWhiteSpace(primaryInfo) Then
    ' You can input the &quot;EXIT&quot; to exit.
    If primaryInfo.ToUpper().CompareTo(&quot;EXIT&quot;) = 0 Then
        Return
    End If
    Dim primaryIdentities() As String = primaryInfo.Split(&quot;,&quot;c)
    For Each primaryIdentity As String In primaryIdentities
        ' If the user identity is valid, we will set it as the ImpersonatedUserId.
        Dim nameResolutions As NameResolutionCollection =
            service.ResolveName(primaryIdentity, ResolveNameSearchLocation.DirectoryOnly,
                                True)
        If nameResolutions.Count &lt;&gt; 1 Then
            Console.WriteLine(&quot;{0} is invalid user identity.&quot;, primaryIdentity)
        Else
            Dim emailAddress As String = nameResolutions(0).Mailbox.Address
            service.ImpersonatedUserId =
                New ImpersonatedUserId(ConnectingIdType.SmtpAddress, emailAddress)
            For Each delegateIdentity As String In delegateIdentities
                AddAccountDelegates(service, emailAddress, delegateIdentity,
                                    permissionLevelName, permissionLevel)
            Next delegateIdentity
        End If
    Next primaryIdentity
</pre>
<pre id="codePreview" class="csharp">
Console.WriteLine(&quot;Please input the user identity you want to set the &quot; &#43;
    &quot;delegates(or you can directly press Enter to set delegates in current account):&quot;);
String primaryInfo = Console.ReadLine();
if (!String.IsNullOrWhiteSpace(primaryInfo))
{
    // You can input the &quot;EXIT&quot; to exit.
    if (primaryInfo.ToUpper().CompareTo(&quot;EXIT&quot;) == 0)
    {
        return;
    }
    String[] primaryIdentities = primaryInfo.Split(',');
    foreach (String primaryIdentity in primaryIdentities)
    {
        // If the user identity is valid, we will set it as the ImpersonatedUserId.
        NameResolutionCollection nameResolutions =
     service.ResolveName(primaryIdentity, ResolveNameSearchLocation.DirectoryOnly, true);
        if (nameResolutions.Count != 1)
        {
            Console.WriteLine(&quot;{0} is invalid user identity.&quot;, primaryIdentity);
        }
        else
        {
            String emailAddress = nameResolutions[0].Mailbox.Address;
            service.ImpersonatedUserId =
                new ImpersonatedUserId(ConnectingIdType.SmtpAddress, emailAddress);
foreach (String delegateIdentity in delegateIdentities)
                        {
                AddAccountDelegates(service, emailAddress, delegateIdentity, 
                    permissionLevelName, permissionLevel);
            }
        }
    }
}
</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style=""></span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-bottom:0pt; line-height:24pt; direction:ltr; unicode-bidi:normal; text-autospace:none">
<span style="font-size:11pt"><span style="font-size:11pt">If we don&rsquo;t have the impersonation permission,
</span><span style="font-size:11pt">we can directly press Enter to add the delegates to the login account.</span></span>
</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span><span class="hidden">vb</span>
<pre class="hidden">
else
{
    // We can also directly press Enter to add the delegates to the login account. 
    foreach (String delegateIdentity in delegateIdentities)
    {
        AddAccountDelegates(service, currentAddress, delegateIdentity, 
            permissionLevelName, permissionLevel);
    }
}
</pre>
<pre class="hidden">
Else
    ' We can also directly press Enter to add the delegates to the login account. 
    For Each delegateIdentity As String In delegateIdentities
        AddAccountDelegates(service, currentAddress, delegateIdentity,
                            permissionLevelName, permissionLevel)
    Next delegateIdentity
End If
</pre>
<pre id="codePreview" class="csharp">
else
{
    // We can also directly press Enter to add the delegates to the login account. 
    foreach (String delegateIdentity in delegateIdentities)
    {
        AddAccountDelegates(service, currentAddress, delegateIdentity, 
            permissionLevelName, permissionLevel);
    }
}
</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-bottom:0pt; line-height:24pt; direction:ltr; unicode-bidi:normal; text-autospace:none">
<span style="font-size:11pt"><span style="font-size:11pt"></span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-bottom:0pt; line-height:24pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="font-size:11pt">We add the delegate to the specifi</span><span style="font-size:11pt">ed</span><span style="font-size:11pt"> a</span><a name="_GoBack"></a><span style="font-size:11pt">ccount.</span></span>
</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span><span class="hidden">vb</span>
<pre class="hidden">
DelegateUser delegateUser = new DelegateUser(delegateAddress);
// Set the permission property of the delegate user.
foreach (PropertyInfo property in typeof(DelegatePermissions).GetProperties())
{
    if (String.Compare(property.Name, permissionLevelName) == 0)
    {
        property.SetValue(delegateUser.Permissions, permissionLevel);
        break;
    }
}
Mailbox emailBox = new Mailbox(primaryAddress);
Collection&lt;DelegateUserResponse&gt; responses = service.AddDelegates(emailBox, 
    MeetingRequestsDeliveryScope.DelegatesAndSendInformationToMe, delegateUser);
foreach (DelegateUserResponse response in responses)
{
    Console.WriteLine(&quot;Add {0} as the delegate to the account {1}:{2}&quot;, 
        delegateAddress, primaryAddress, response.Result);
    Console.WriteLine();
}
</pre>
<pre class="hidden">
Dim delegateUser As New DelegateUser(delegateAddress)
' Set the permission property of the delegate user.
For Each [property] As PropertyInfo In GetType(DelegatePermissions).GetProperties()
    If String.Compare([property].Name, permissionLevelName) = 0 Then
        [property].SetValue(delegateUser.Permissions, permissionLevel)
        Exit For
    End If
Next [property]
Dim emailBox As New Mailbox(primaryAddress)
Dim responses As Collection(Of DelegateUserResponse) =
    service.AddDelegates(emailBox,
                         MeetingRequestsDeliveryScope.DelegatesAndSendInformationToMe,
                         delegateUser)
For Each response As DelegateUserResponse In responses
    Console.WriteLine(&quot;Add {0} as the delegate to the account {1}:{2}&quot;,
                      delegateAddress, primaryAddress, response.Result)
    Console.WriteLine()
Next response
        End Sub
</pre>
<pre id="codePreview" class="csharp">
DelegateUser delegateUser = new DelegateUser(delegateAddress);
// Set the permission property of the delegate user.
foreach (PropertyInfo property in typeof(DelegatePermissions).GetProperties())
{
    if (String.Compare(property.Name, permissionLevelName) == 0)
    {
        property.SetValue(delegateUser.Permissions, permissionLevel);
        break;
    }
}
Mailbox emailBox = new Mailbox(primaryAddress);
Collection&lt;DelegateUserResponse&gt; responses = service.AddDelegates(emailBox, 
    MeetingRequestsDeliveryScope.DelegatesAndSendInformationToMe, delegateUser);
foreach (DelegateUserResponse response in responses)
{
    Console.WriteLine(&quot;Add {0} as the delegate to the account {1}:{2}&quot;, 
        delegateAddress, primaryAddress, response.Result);
    Console.WriteLine();
}
</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style=""></span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; margin-top:10pt; margin-bottom:0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:13pt"><span style="font-weight:bold; font-size:13pt">More Information</span></span>
</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><a href="http://msdn.microsoft.com/en-us/library/dd633709(v=exchg.80).aspx" style="text-decoration:none"><span style="color:#0563C1; text-decoration:underline">EWS Managed API 2.0</span></a><span style="font-size:11pt">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt"><span style="color:#0563C1; color:windowtext"></span><a href="http://msdn.microsoft.com/en-us/library/dd633680(v=exchg.80).aspx" style="text-decoration:none"><span style="color:#0563C1; text-decoration:underline">Working with impersonation
 by using the EWS Managed API</span></a></span> </p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:27.6pt; margin-bottom:10pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:11pt">&nbsp;</span> </p>
<p style="line-height:0.6pt; color:white">Microsoft All-In-One Code Framework is a free, centralized code sample library driven by developers' real-world pains and needs. The goal is to provide customer-driven code samples for all Microsoft development technologies,
 and reduce developers' efforts in solving typical programming tasks. Our team listens to developers’ pains in the MSDN forums, social media and various DEV communities. We write code samples based on developers’ frequently asked programming tasks, and allow
 developers to download them with a short sample publishing cycle. Additionally, we offer a free code sample request service. It is a proactive way for our developer community to obtain code samples directly from Microsoft.</p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="description/adaa87bc-3ace-4da7-8848-07ab8276df38image.png">
</a></div>

</div>


    </div>
</body>
</html>
