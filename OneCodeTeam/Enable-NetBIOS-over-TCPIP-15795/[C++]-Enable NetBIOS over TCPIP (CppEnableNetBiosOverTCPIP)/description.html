<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/67b74b86-a273-4ad7-9ed5-0f97276412eaCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Enable NetBIOS over TCP/IP (CppEnableNetBiosOverTCPIP)</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Enable NetBIOS over TCP/IP (CppEnableNetBiosOverTCPIP)</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Windows SDK, Network
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            netbios
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">3/1/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/CppEnableNetBiosOverTCPIP-ed32d818">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div class="WordSection1">
<h1>Set the NetBIOS o<span class="GramE">ver</span> TCP/IP on the server. (<span class="SpellE">CppEnableNetBiosOverTCPIP</span>)</h1>
<h2>Introduction</h2>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
This sample application demonstrates how to set the NetBIOS <span class="GramE">
Over</span> TCP/IP on the server. We are using here WMI&rsquo;s class <span style="font-size:9.5pt; font-family:Consolas; color:#a31515">
Win32_NetworkAdapterConfiguration </span>under <span style="font-size:9.5pt; font-family:Consolas; color:#a31515">
ROOT\CimV2 </span>namespace.&nbsp;&nbsp;</p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
This namespace is provided by Microsoft to manage most of the WMI Classes.<span>&nbsp;
</span>This application takes the advantages of WMI classes and executes the method
<span class="SpellE"><span style="font-size:9.5pt; font-family:Consolas; color:#a31515">SetTCPIPNetBIOS</span></span>.&nbsp;</p>
<p class="MsoNormal">To know more about Net BIOS Over TCP IP, please visit <a href="http://technet.microsoft.com/en-us/library/bb727013.aspx">
http://technet.microsoft.com/en-us/library/bb727013.aspx</a><span>&nbsp; </span></p>
<h2>Running the Sample</h2>
<p class="MsoNormal">In order to execute this sample code, we need a Server where NIC is IP Enabled. You must execute this application under Administrator privileges as this requires admin privileges to update NIC configuration.</p>
<p class="MsoNormal">We should know which we are going to pass to the method <span class="SpellE">
SetTcpipNetBIOS</span>. This can be found here, <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa393601(v=vs.85).aspx">
http://msdn.microsoft.com/en-us/library/windows/desktop/aa393601(v=vs.85).aspx</a>. In our case, it should be 1 (0x1<span class="GramE">)<span>&nbsp;
</span>Enable</span> <span class="SpellE">Netbios</span>.</p>
<h2>Using the Code</h2>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
Since this is a C&#43;&#43; Application, we need to include certain header files: <span class="SpellE">
<span style="font-size:9.5pt; font-family:Consolas; color:#a31515">comdef.h</span></span> for COM &amp;
<span class="SpellE"><span style="font-size:9.5pt; font-family:Consolas; color:#a31515">Wbemidl.h</span></span> for WMI. In the code, first we need to initialize COM by calling (<span class="SpellE"><span style="font-size:9.5pt; font-family:Consolas">CoInitializeEx</span></span>).
 Once the COM is initialized we need to set the COM general security calling (<span class="SpellE"><span style="font-size:9.5pt; font-family:Consolas">CoInitializeSecurity</span></span>). Then we require
<span class="GramE">to get</span> the WMI Locator in order to connect to a WMI service by calling (<span class="SpellE"><span style="font-size:9.5pt; font-family:Consolas">CoCreateInstance</span></span>) &amp; (<span class="SpellE"><span style="font-size:9.5pt; font-family:Consolas">IWbemServices</span></span>::<span class="SpellE"><span style="font-size:9.5pt; font-family:Consolas">ConnectServer</span></span>).
 While connecting to the WMI service we need to connect to the <span style="font-size:9.5pt; font-family:Consolas; color:#a31515">
ROOT\CimV2 </span>namespace. This namespace gives us the facilities to work with the most of the base WMI classes. After we obtain the connection to the WMI service we would require to setting the proxy setting via
<span class="SpellE"><span style="font-size:9.5pt; font-family:Consolas">CoSetProxyBlanket</span></span>, make sure we use the impersonation level as
<span style="font-size:9.5pt; font-family:Consolas">RPC_C_IMP_LEVEL_IMPERSONATE</span>.&nbsp;</p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
For executing this method <span class="SpellE">SetTCPIPNetBios</span> we need to first get the Network adapter where the IP is enabled. For this we would need to fire a WQL as &ldquo;<span style="font-size:9.5pt; font-family:Consolas; color:#a31515">Select
 * From Win32_NetworkAdapterConfiguration Where <span class="SpellE">IPEnabled</span> = True</span>&rdquo; Once we get this record, we need to get the instance of this record by getting the __RELPATH and then we need to execute the method &ldquo;<span class="SpellE">SetTCPIPNetBIOS</span>&rdquo;&nbsp;</p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
This takes one parameter: <span class="GramE">uint32</span> <span class="SpellE">
TcpipNetbiosOptions</span>, which can be:</p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<strong><span style="font-size:9.5pt; font-family:Consolas; color:#a31515">&nbsp;</span></strong></p>
<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0" style="margin-left:.5in; border-collapse:collapse">
<tbody>
<tr>
<td valign="top" style="border:none; border-bottom:solid #DBDBDB 1.0pt; padding:7.5pt 6.0pt 7.5pt 6.0pt">
<p class="MsoNormal" style="margin-top:0in; margin-right:7.5pt; margin-bottom:.0001pt; margin-left:7.5pt; line-height:normal">
<span style="font-size:9.0pt; font-family:&quot;Segoe UI&quot;,&quot;sans-serif&quot;; color:#2a2a2a">0 (0x0)
</span></p>
</td>
<td valign="top" style="border:none; border-bottom:solid #DBDBDB 1.0pt; padding:7.5pt 6.0pt 7.5pt 6.0pt">
<p class="MsoNormal" style="margin-top:0in; margin-right:7.5pt; margin-bottom:.0001pt; margin-left:7.5pt; line-height:13.5pt">
<span style="font-size:9.0pt; font-family:&quot;Segoe UI&quot;,&quot;sans-serif&quot;; color:#2a2a2a">Enable
<span class="SpellE">Netbios</span> via DHCP</span></p>
</td>
</tr>
<tr>
<td valign="top" style="border:none; border-bottom:solid #DBDBDB 1.0pt; padding:7.5pt 6.0pt 7.5pt 6.0pt">
<p class="MsoNormal" style="margin-top:0in; margin-right:7.5pt; margin-bottom:.0001pt; margin-left:7.5pt; line-height:normal">
<span style="font-size:9.0pt; font-family:&quot;Segoe UI&quot;,&quot;sans-serif&quot;; color:#2a2a2a">1 (0x1)
</span></p>
</td>
<td valign="top" style="border:none; border-bottom:solid #DBDBDB 1.0pt; padding:7.5pt 6.0pt 7.5pt 6.0pt">
<p class="MsoNormal" style="margin-top:0in; margin-right:7.5pt; margin-bottom:.0001pt; margin-left:7.5pt; line-height:13.5pt">
<span style="font-size:9.0pt; font-family:&quot;Segoe UI&quot;,&quot;sans-serif&quot;; color:#2a2a2a">Enable
<span class="SpellE">Netbios</span></span></p>
</td>
</tr>
<tr>
<td valign="top" style="border:none; border-bottom:solid #DBDBDB 1.0pt; padding:7.5pt 6.0pt 7.5pt 6.0pt">
<p class="MsoNormal" style="margin-top:0in; margin-right:7.5pt; margin-bottom:.0001pt; margin-left:7.5pt; line-height:normal">
<span style="font-size:9.0pt; font-family:&quot;Segoe UI&quot;,&quot;sans-serif&quot;; color:#2a2a2a">2 (0x2)
</span></p>
</td>
<td valign="top" style="border:none; border-bottom:solid #DBDBDB 1.0pt; padding:7.5pt 6.0pt 7.5pt 6.0pt">
<p class="MsoNormal" style="margin-top:0in; margin-right:7.5pt; margin-bottom:.0001pt; margin-left:7.5pt; line-height:13.5pt">
<span style="font-size:9.0pt; font-family:&quot;Segoe UI&quot;,&quot;sans-serif&quot;; color:#2a2a2a">Disable
<span class="SpellE">Netbios</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
In our case it will be Enable NetBIOS i.e. 0x1.</p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span>We will execute the method with the help of <span class="SpellE">IWbemServices</span>::<span class="SpellE">ExecMethod</span>. This method returns the HRESULT and if successful we need to release all the pointers and must exit out gracefully.</span></p>
<h2>More Information</h2>
<p class="MsoNormal">For more information on:</p>
<p class="MsoListParagraph" style="text-indent:-.25in"><span style="font-family:Symbol"><span>&middot;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>Working on WMI via C&#43;&#43;:</p>
<p class="MsoNormal" style="margin-left:.5in"><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa394558(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/aa394558(v=vs.85).aspx</a></p>
<p class="MsoNormal" style="margin-left:.5in"><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa389762(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/aa389762(v=vs.85).aspx</a></p>
<p class="MsoListParagraphCxSpFirst" style="text-indent:-.25in"><span style="font-family:Symbol"><span>&middot;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>Win32_NetworkConfigurationClass:</p>
<p class="MsoListParagraphCxSpLast"><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa394217(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/aa394217(v=vs.85).aspx</a></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><br>
</p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img src="description/95e3bc78-76ea-4f7c-8b0e-445ca740f249image.png" alt=""></a></div>
<p></p>
<p class="MsoNormal">&nbsp;</p>
</div>

</div>


    </div>
</body>
</html>
