<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=5CF4E24D59324FBE66CF8C9A49A3F942" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:FooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=F8E8917DA8158DB3E7C6F07AA1FFC4F3" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>How to increase the idle timeout property in IIS for Windows Azure applications</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>How to increase the idle timeout property in IIS for Windows Azure applications</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Microsoft Azure, Cloud
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            timeout
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">1/19/2015</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<p><strong style="font-size:10px"><a href="http://blogs.msdn.com/b/onecode"><img src="description/8171.onecodesampletopbanner.png" alt=""></a></strong></p>
<h1><strong><strong>Increase application pool idle timeout in windows azure cloud applications
</strong><strong>&nbsp;</strong></strong></h1>
<p><strong></p>
<h2><strong>Introduction</strong></h2>
</strong>
<p>App-pool Idle Time-out is the amount of time (in minutes) a worker process will remain idle before it shuts down. A worker process is idle if it is not processing requests and no new requests are received.&nbsp;&nbsp;</p>
<p>Idle Time-out property can be changed in IIS after you RDP into the VM's of Azure, but this is not recommended and remote desktop must be used only for basic troubleshooting. Any changes done on the Virtual Machine manually after RDP will not be persisted.This
 is because, in the event of any hardware failure or automatic OS upgrade in Azure cloud, Fabric controller will bring down the VM instance and automatically deploy your package on another VM/on the same VM (Virtual machine). If this happens all the changes
 done manually on the VM will be lost. Therefore the recommended approach is to perform all the operation by code and deploy the package.</p>
<p>You can implement this by using ServerManager class defined in <a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/Microsoft.Web.Administration.aspx"  title="Auto generated link to Microsoft.Web.Administration">Microsoft.Web.Administration</a> DLL.</p>
<strong>
<h2><strong>Running the Sample</strong></h2>
</strong>
<p>You can directly publish this sample to your cloud service.</p>
<strong>
<h2><strong>Using the Code</strong></h2>
</strong>
<p>You can use the code below to achieve this:</p>
<p>&nbsp;</p>
<strong>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">using System;
using <a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/System.Collections.Generic.aspx"  title="Auto generated link to System.Collections.Generic">System.Collections.Generic</a>;
using <a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/System.Linq.aspx"  title="Auto generated link to System.Linq">System.Linq</a>;
using <a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/Microsoft.WindowsAzure.aspx"  title="Auto generated link to Microsoft.WindowsAzure">Microsoft.WindowsAzure</a>;
using <a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/Microsoft.WindowsAzure.Diagnostics.aspx"  title="Auto generated link to Microsoft.WindowsAzure.Diagnostics">Microsoft.WindowsAzure.Diagnostics</a>;
using <a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/Microsoft.WindowsAzure.ServiceRuntime.aspx"  title="Auto generated link to Microsoft.WindowsAzure.ServiceRuntime">Microsoft.WindowsAzure.ServiceRuntime</a>;
using <a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/Microsoft.Web.Administration.aspx"  title="Auto generated link to Microsoft.Web.Administration">Microsoft.Web.Administration</a>;
using <a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/Microsoft.WindowsAzure.Diagnostics.Management.aspx"  title="Auto generated link to Microsoft.WindowsAzure.Diagnostics.Management">Microsoft.WindowsAzure.Diagnostics.Management</a>;
 
 
namespace WebRole
{
    public class WebRole : RoleEntryPoint
    {
 
        public override bool OnStart()
        {
 
            ServerManager iisManager = new ServerManager();
            Application app = iisManager.Sites[RoleEnvironment.CurrentRoleInstance.Id &#43; &quot;_Web&quot;].Applications[0];
 
            //================ idletimeout ====================================================//               
            string dt = iisManager.ApplicationPoolDefaults.ProcessModel.IdleTimeout.ToString();
            TimeSpan ts = new TimeSpan(0, 60, 00);
            iisManager.ApplicationPoolDefaults.ProcessModel.IdleTimeout = ts;
 
 
 
            //================ Enable or disable static/Dynamic compression ===================//
            Configuration config = iisManager.Sites[RoleEnvironment.CurrentRoleInstance.Id &#43; &quot;_Web&quot;].GetWebConfiguration();
            ConfigurationSection urlCompressionSection = config.GetSection(&quot;system.webServer/urlCompression&quot;);
            urlCompressionSection[&quot;doStaticCompression&quot;] = true;
            urlCompressionSection[&quot;doDynamicCompression&quot;] = true;
 
            //================ To change Application pool name ================================//
 
            app.ApplicationPoolName = &quot;ASP.NET v4.0 Classic&quot;;
            // Commit the changes done to server manager. 
 
            iisManager.CommitChanges();
 
            return base.OnStart();
 
        }
 
    }
 
}</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">using</span>&nbsp;System;&nbsp;
<span class="cs__keyword">using</span>&nbsp;<a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/System.Collections.Generic.aspx"  title="Auto generated link to System.Collections.Generic">System.Collections.Generic</a>;&nbsp;
<span class="cs__keyword">using</span>&nbsp;<a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/System.Linq.aspx"  title="Auto generated link to System.Linq">System.Linq</a>;&nbsp;
<span class="cs__keyword">using</span>&nbsp;<a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/Microsoft.WindowsAzure.aspx"  title="Auto generated link to Microsoft.WindowsAzure">Microsoft.WindowsAzure</a>;&nbsp;
<span class="cs__keyword">using</span>&nbsp;<a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/Microsoft.WindowsAzure.Diagnostics.aspx"  title="Auto generated link to Microsoft.WindowsAzure.Diagnostics">Microsoft.WindowsAzure.Diagnostics</a>;&nbsp;
<span class="cs__keyword">using</span>&nbsp;<a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/Microsoft.WindowsAzure.ServiceRuntime.aspx"  title="Auto generated link to Microsoft.WindowsAzure.ServiceRuntime">Microsoft.WindowsAzure.ServiceRuntime</a>;&nbsp;
<span class="cs__keyword">using</span>&nbsp;<a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/Microsoft.Web.Administration.aspx"  title="Auto generated link to Microsoft.Web.Administration">Microsoft.Web.Administration</a>;&nbsp;
<span class="cs__keyword">using</span>&nbsp;<a class="libraryLink" href="https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://code.msdn.microsoft.com/How-to-increase-the-idle-ca36c7ad/https://msdn.microsoft.com/en-US/library/Microsoft.WindowsAzure.Diagnostics.Management.aspx"  title="Auto generated link to Microsoft.WindowsAzure.Diagnostics.Management">Microsoft.WindowsAzure.Diagnostics.Management</a>;&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;
<span class="cs__keyword">namespace</span>&nbsp;WebRole&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">public</span><span class="cs__keyword">class</span>&nbsp;WebRole&nbsp;:&nbsp;RoleEntryPoint&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">public</span><span class="cs__keyword">override</span><span class="cs__keyword">bool</span>&nbsp;OnStart()&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerManager&nbsp;iisManager&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;ServerManager();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Application&nbsp;app&nbsp;=&nbsp;iisManager.Sites[RoleEnvironment.CurrentRoleInstance.Id&nbsp;&#43;&nbsp;<span class="cs__string">&quot;_Web&quot;</span>].Applications[<span class="cs__number">0</span>];&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//================&nbsp;idletimeout&nbsp;====================================================//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs__keyword">string</span>&nbsp;dt&nbsp;=&nbsp;iisManager.ApplicationPoolDefaults.ProcessModel.IdleTimeout.ToString();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimeSpan&nbsp;ts&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;TimeSpan(<span class="cs__number">0</span>,&nbsp;<span class="cs__number">60</span>,&nbsp;<span class="cs__number">00</span>);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iisManager.ApplicationPoolDefaults.ProcessModel.IdleTimeout&nbsp;=&nbsp;ts;&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//================&nbsp;Enable&nbsp;or&nbsp;disable&nbsp;static/Dynamic&nbsp;compression&nbsp;===================//</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Configuration&nbsp;config&nbsp;=&nbsp;iisManager.Sites[RoleEnvironment.CurrentRoleInstance.Id&nbsp;&#43;&nbsp;<span class="cs__string">&quot;_Web&quot;</span>].GetWebConfiguration();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConfigurationSection&nbsp;urlCompressionSection&nbsp;=&nbsp;config.GetSection(<span class="cs__string">&quot;system.webServer/urlCompression&quot;</span>);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;urlCompressionSection[<span class="cs__string">&quot;doStaticCompression&quot;</span>]&nbsp;=&nbsp;<span class="cs__keyword">true</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;urlCompressionSection[<span class="cs__string">&quot;doDynamicCompression&quot;</span>]&nbsp;=&nbsp;<span class="cs__keyword">true</span>;&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//================&nbsp;To&nbsp;change&nbsp;Application&nbsp;pool&nbsp;name&nbsp;================================//</span>&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.ApplicationPoolName&nbsp;=&nbsp;<span class="cs__string">&quot;ASP.NET&nbsp;v4.0&nbsp;Classic&quot;</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//&nbsp;Commit&nbsp;the&nbsp;changes&nbsp;done&nbsp;to&nbsp;server&nbsp;manager.&nbsp;</span>&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iisManager.CommitChanges();&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">return</span><span class="cs__keyword">base</span>.OnStart();&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;
}</pre>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2><strong>More Information</strong></h2>
</strong>
<p><a href="http://blogs.msdn.com/b/sriharsha/archive/2012/04/07/how-to-increase-application-pool-idletimeout-in-windows-azure-cloud-applications.aspx">http://blogs.msdn.com/b/sriharsha/archive/2012/04/07/how-to-increase-application-pool-idletimeout-in-windows-azure-cloud-applications.aspx</a></p>
<p></p>

</div>


    </div>
</body>
</html>
