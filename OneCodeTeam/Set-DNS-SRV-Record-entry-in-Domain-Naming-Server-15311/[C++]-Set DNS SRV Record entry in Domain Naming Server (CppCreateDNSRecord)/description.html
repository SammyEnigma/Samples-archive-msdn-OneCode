<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/67b74b86-a273-4ad7-9ed5-0f97276412eaCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Set DNS SRV Record entry in Domain Naming Server (CppCreateDNSRecord)</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Set DNS SRV Record entry in Domain Naming Server (CppCreateDNSRecord)</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            WMI
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            DNS
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">2/22/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/CppCreateDNSRecord-9edac3c1">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div class="WordSection1">
<h1>This sample application demonstrates how to set the DNS SRV Record entry in the Domain Naming Server via C&#43;&#43;. (<span class="SpellE">CppCreateDNSRecord</span>)</h1>
<h2>Introduction</h2>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
This sample application demonstrates how to set the DNS SRV Record entry in the Domain Naming Server via C&#43;&#43;. We are using here WMI&rsquo;s class
<span class="SpellE"><span style="font-size:9.5pt; font-family:Consolas; color:#a31515">MicrosoftDNS_SRVType</span></span><span style="font-size:9.5pt; font-family:Consolas; color:#a31515">
</span>under <span style="font-size:9.5pt; font-family:Consolas; color:#a31515">ROOT\<span class="SpellE">MicrosoftDNS</span>
</span>namespace.</p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
This namespace is provided by Microsoft to manage DNS.<span>&nbsp; </span>This application takes the advantages of WMI classes and executes the method
<span class="SpellE"><span style="font-size:9.5pt; font-family:Consolas; color:#a31515">CreateInstanceFromPropertydata</span></span>.</p>
<p class="MsoNormal">To know more about SRV Records, please visit <a href="http://technet.microsoft.com/en-us/library/cc742513.aspx">
http://technet.microsoft.com/en-us/library/cc742513.aspx</a> &amp; <a href="http://technet.microsoft.com/en-us/library/cc772362.aspx">
http://technet.microsoft.com/en-us/library/cc772362.aspx</a></p>
<h2>Running the Sample</h2>
<p class="MsoNormal">In order to execute this sample code, we need a DNS Server which is in a domain. You must execute this application under Domain Administrator privileges as this requires domain admin privileges to update DNS SRV records.</p>
<p class="MsoNormal">Once we have this DNS Server, we need to know what <span class="GramE">
are the following parameters value</span> in domain:</p>
<ul>
<li>
<div class="MsoNormal">DNS Server Name</div>
</li><li>
<div class="MsoNormal">Container Name</div>
</li><li>
<div class="MsoNormal">Owner Name</div>
</li><li>
<div class="MsoNormal">Priority</div>
</li><li>
<div class="MsoNormal">Weight</div>
</li><li>
<div class="MsoNormal">Port</div>
</li><li>
<div class="MsoNormal">Domain Name</div>
</li></ul>
<h2>Using the Code</h2>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span>Since this is a C&#43;&#43; Application, we need to include certain header files: </span>
<span class="SpellE"><span style="color:#a31515">comdef.h</span></span><span> for COM &amp;
</span><span class="SpellE"><span style="color:#a31515">Wbemidl.h</span></span><span> for WMI. In the code, first we need to initialize COM by calling (</span><span class="SpellE"><span>CoInitializeEx</span></span><span>). Once the COM is initialized we
 need to set the COM general security calling (</span><span class="SpellE"><span>CoInitializeSecurity</span></span><span>). Then we require
<span class="GramE">to get</span> the WMI Locator in order to connect to a WMI service by calling (</span><span class="SpellE"><span>CoCreateInstance</span></span><span>) &amp; (</span><span class="SpellE"><span>IWbemServices</span></span><span>::</span><span class="SpellE"><span>ConnectServer</span></span><span>).
 While connecting to the WMI service we need to connect to the </span><span style="color:#a31515">ROOT\<span class="SpellE">MicrosoftDNS</span>
</span><span>namespace. This namespace gives us the facilities to work with the Domain Naming Server. After we obtain the connection to the WMI service we would require to setting the proxy setting via
</span><span class="SpellE"><span>CoSetProxyBlanket</span></span><span>, make sure we use the impersonation level as
</span><span>RPC_C_IMP_LEVEL_IMPERSONATE</span><span>.</span></p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span>For creating the DNS record we have a class called </span><span class="SpellE"><span style="color:#a31515">MicrosoftDNS_SRVType</span></span><span> which has a method called
</span><span class="SpellE"><span style="color:#a31515">CreateInstanceFromPropertydata</span></span><span>. This
<span class="GramE">methods</span> takes certain important parameters as described below:</span></p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span class="SpellE"><span style="color:green">DnsServerName</span></span><span style="color:green"> =&gt; This takes the FQDN of the DNS Server</span></p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span class="SpellE"><span style="color:green">ContainerName</span></span><span style="color:green"> =&gt; FQDN of domain controller or called Container</span></p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span class="SpellE"><span style="color:green">OwnerName</span></span><span style="color:green"> =&gt;
<span class="GramE">Should</span> be the New alias name, in FQDN format</span></p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span class="SpellE"><span style="color:green">RecordClass</span></span><span style="color:green"> =&gt; It should be the record class, generally passed as 0</span></p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="color:green">TTL =&gt; It must be 0 while creating the DNS SVR Record</span></p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="color:green">Priority =&gt; Priority can be defined as per your need, generally it is 0</span></p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="color:green">Weight =&gt; As Priority, Weight can be as per your requirement.</span></p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="color:green">Port<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>=&gt; This will be the port on which DNS SRV Record will work.</span></p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span class="SpellE"><span style="color:green">DomainName</span></span><span style="color:green"> =&gt; This should be the FQDN of the Domain.</span></p>
<p class="MsoNormal" style="margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span>Once we set the above parameters, we will execute <span class="SpellE"><span style="color:#a31515">CreateInstanceFromPropertydata</span></span> method with the help of
<span class="SpellE">IWbemServices</span>:<span class="GramE">:<span class="SpellE">ExecMethod.This</span></span> method returns the HRESULT and if successful we need to release all the pointers and must exit out gracefully.</span></p>
<h2>More Information</h2>
<p class="MsoNormal">For more information on:</p>
<p class="MsoListParagraph" style="text-indent:-.25in"><span style="font-family:Symbol"><span>&middot;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>Working on WMI via C&#43;&#43;:</p>
<p class="MsoNormal" style="text-indent:.5in"><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa394558(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/aa394558(v=vs.85).aspx</a></p>
<p class="MsoNormal" style="text-indent:.5in"><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa389762(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/aa389762(v=vs.85).aspx</a></p>
<p class="MsoListParagraph" style="text-indent:-.25in"><span style="font-family:Symbol"><span>&middot;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span>Microsoft DNS Namespace &amp; Classes:</p>
<p class="MsoNormal" style="text-indent:.5in"><a href="http://technet.microsoft.com/en-us/library/dd197491(WS.10).aspx">http://technet.microsoft.com/en-us/library/dd197491(WS.10).aspx</a></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">&nbsp;<br>
</p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img src="description/95e3bc78-76ea-4f7c-8b0e-445ca740f249image.png" alt=""></a></div>
<p></p>
</div>

</div>


    </div>
</body>
</html>
