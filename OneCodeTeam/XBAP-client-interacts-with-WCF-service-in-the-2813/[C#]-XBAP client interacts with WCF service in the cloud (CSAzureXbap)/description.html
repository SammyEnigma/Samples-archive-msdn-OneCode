<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/67b74b86-a273-4ad7-9ed5-0f97276412eaCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>XBAP client interacts with WCF service in the cloud (CSAzureXbap)</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>XBAP client interacts with WCF service in the cloud (CSAzureXbap)</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Microsoft Azure
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            XBAP
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">4/16/2013</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/CSAzureXbap-7b7f0020">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<p style="font-family:Courier New">&nbsp;<a href="http://www.microsoft.com/click/services/Redirect2.ashx?CR_CC=200144420" ><img id="79969" src="description/120x90_Azure_web_EN_US.jpg" alt="" width="360" height="90"></a></p>
<p style="font-family:Courier New">&nbsp;</p>
<h2>Overview</h2>
<p>In a typical cloud development scenario, you host a web service in the cloud, distribute a client application from the cloud, and consume the service from the client application.</p>
<p>This sample demonstrates the above typical scenario, where the client application is a XBAP application, and the cloud service is a WCF service hosted in a Windows Azure Web Role.</p>
<div align="right">
<p><a href="http://www.microsoft.com/click/services/Redirect2.ashx?CR_CC=200144420"><span style="color:windowtext; text-decoration:none"><span><img src="description/image.png" alt="" width="120" height="90" align="middle">
</span></span></a><br>
<a href="http://www.microsoft.com/click/services/Redirect2.ashx?CR_CC=200144420">Try Windows Azure for free for 90 Days!</a></p>
</div>
<h2>Choose Silverlight or XBAP</h2>
<p>I create this sample because several customers ask how to distribute XBAP from Windows Azure. But before you go, please note in most cases, you should use Silverlight rather than XBAP. Silverlight has a bunch of advantages over XBAP, for example:</p>
<ul>
<li>Client only needs a Silverlight plug-in (about 5MB download), rather than .NET Client Profile (about 30MB download), or full .NET (about 50MB download).
</li><li>Supported on Mac OS (and Linux via Moonlight). </li><li>Support more web browsers. </li><li>Easier to consume web services, both a service from the same Web Role, or a cross domain service.
</li><li>Easier to deploy, and can be associated to a Web Role project automatically. </li><li>Supports OOB. </li><li>Easier to port to Windows Phone. </li><li>Deep Zoom integration. </li></ul>
<p>However, XBAP also provides its unique features, which are either difficult, or impossible to achieve in Silverlight. This includes full 3D capabilities and full trust mode.</p>
<p>This sample uses the CS/VBWPF3DMultiTouch sample we built a while ago, since 3D is a one of the use cases where XBAP makes more sense than Silverlight. For more information about the client application, please read the ReadMe.htm document in the CS/VBWPF3DMultiTouch
 sample.</p>
<p>A few modifications have been made on the client sample:</p>
<ol>
<li>Use XBAP instead of a desktop WPF application. </li><li>Use the default partial trust model of XBAP. Fortunately, the CS/VBWPF3DMultiTouch sample doesn't require any features that are not supported in partial trust.
</li><li>Invoke a WCF service to obtain the Windows Azure data center list. (The original sample embeds the list in the client application directly.)
</li></ol>
<h2>Prerequisites</h2>
<p>For this sample to work, you must have Visual Studio 2010, .NET 4, and Windows Azure SDK 1.3 or later. You must use Windows 7. You also need to have a Windows 7 compatible multi-touch screen. If you don't have a touch screen, you can still use mouse to manipulate
 the earth, but you won't be able to enjoy the fun provided by the touching experience.</p>
<h2>Distribute XBAP from Windows Azure</h2>
<p>To distribute a XBAP from Windows Azure, please use the following steps:</p>
<ol>
<li>Create a Windows Azure solution with at least one Web Role project. </li><li>Create a new (or include an existing) XBAP project in the same solution. </li><li>Build the solution. </li><li>Right click the Web Role project, choose Add existing item, navigate to the output directory of the XBAP application, and add the following files to the Web Role project:
<ul>
<li>***.exe </li><li>***.exe.manifest </li><li>***.xbap </li></ul>
</li><li>Select the above files, and set their Build Action to Content. </li><li>In the XBAP project's properties page, click the Publish tab. </li><li>Click the Options button. </li><li>In the popup dialog, select the Deployment tab. </li><li>Uncheck &quot;Use .deploy file extension&quot;. If the check box is checked (default), the manifest will point to a ***.exe.deploy file instead of ***.exe file.
</li><li>Alternatively, if you don't perform step 6~9, you can rename the ***.exe file to ***.exe.deploy.
</li><li>If you want to display the XBAP application when the user navigates to the root URI of your Web Role, please modify web.config, and add the following under the system.webServer section (replace XbapClient.xbap with your XBAP's name):
<ol>
<pre style="font-family:consolas"><span style="color:blue">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515">defaultDocument</span><span style="color:blue">&gt;</span>
<span style="color:blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515">files</span><span style="color:blue">&gt;</span>
<span style="color:blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515">clear</span><span style="color:blue">/&gt;</span>
<span style="color:blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#a31515">add</span><span style="color:blue">&nbsp;</span><span style="color:red">value</span><span style="color:blue">=</span>&quot;<span style="color:blue">XbapClient.xbap</span>&quot;<span style="color:blue">/&gt;</span>
<span style="color:blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515">files</span><span style="color:blue">&gt;</span>
<span style="color:blue">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#a31515">defaultDocument</span><span style="color:blue">&gt;</span>
</pre>
</ol>
</li></ol>
<p>Now run the solution in Development Fabric, and you should be able to see the XBAP application. It also works fine after deployed to the real cloud.</p>
<p>If you want to modify the original XBAP project, you must take additional steps for the changes to be reflected in the Web Role:</p>
<ul>
<li>Open Visual Studio command prompt, and run this command to clear the XBAP cache: mage -cc
</li><li>Delete the .exe, .manifest, and .xbap files from the Web Role. </li><li>Repeat step 3 to step 5 above. </li></ul>
<p>As you can see, since a XBAP project cannot be associated to a Web Role project automatically, you have a lot of manual tasks to do whenever you want to update the XBAP project. You can try to create a Visual Studio script to automate the process, but if
 a Silverlight project meets your requirement, you should definitely use Silverlight.</p>
<h2>Access web services from XBAP</h2>
<p>In most cases, the client applications distributed from the cloud need to invoke web services hosted in the cloud, to provide a true connected experience. This sample demonstrates how to access a WCF SOAP service from XBAP.</p>
<p>The process is similar to accessing a SOAP service from a normal client. If you need to allow clients to add a service reference to your Windows Azure WCF service, you need the hotfix and workaround described on
<a href="http://support.microsoft.com/kb/971842">http://support.microsoft.com/kb/971842</a>. However, there're also a few unique tasks to perform in order to make WCF calls successful in XBAP:</p>
<p>First of all, you must configure the service endpoint in code, rather than in app.config. By default, in Windows Azure (and normal IIS environment), *.config files, such as web.config and app.config, are not allowed to be downloaded to the client. You can
 configure system.webServer to allow the download, but that makes web.config to be downloadable as well, which may cause serious security concerns. So it is always recommended to take the code only approach for XBAP applications. Silverlight applications do
 not have this problem, because the configuration file name's extension is ClientConfig, rather than config.</p>
<p>After adding the service reference, please remove the generated app.config file.</p>
<p>To configure the service endpoint in code, you can use the following overload of the client proxy class:</p>
<pre style="font-family:consolas"><span style="color:blue">public</span>&nbsp;DataCenterServiceClient(System.ServiceModel.Channels.<span style="color:#2b91af">Binding</span>&nbsp;binding,&nbsp;System.ServiceModel.<span style="color:#2b91af">EndpointAddress</span>&nbsp;remoteAddress)
</pre>
<p>This overload requires the service address information. You can use an absolute address. But if the service is hosted in the same Web Role, it is recommended to use a relative URI, so that you don't need to modify the code before deploying the application
 to the cloud. The relative URI can be obtained with the help of BrowserInteropHelper.Source property:</p>
<pre style="font-family:consolas">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">Uri</span>&nbsp;serviceUri&nbsp;=&nbsp;<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">Uri</span>(<span style="color:#2b91af">BrowserInteropHelper</span>.Source,&nbsp;<span style="color:#a31515">&quot;../DataCenterService.svc&quot;</span>);
</pre>
<p>In addition, by default, a partial trust XBAP can only consume services from the same domain. To invoke cross domain services, you must modify the application properties to use full trust, or grant yourself permission to access web resources. Silverlight
 cross domain access policy file does not affect XBAP. Note if your XBAP is not use the default partial trust configuration, you must make sure it does not perform any tasks that may harm the end user's machine, and you must sign the XBAP with a valid certificate,
 otherwise you won't be able to deploy a non-default partial trust XBAP to an internet environment, such as the cloud. This sample does not cover the non-default partial trust scenario.</p>
<h2>Conclusion</h2>
<p>The cloud allows you to host services, as well as distribute client applications. One type of those client applications is XBAP. As you can see in the sample, XBAP is fully supported in Windows Azure. However, whenever Silverlight can be used, you should
 choose Silverlight instead of XBAP.</p>
<p>&nbsp;</p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img src="description/95e3bc78-76ea-4f7c-8b0e-445ca740f249image.png" alt="">
</a></div>

</div>


    </div>
</body>
</html>
