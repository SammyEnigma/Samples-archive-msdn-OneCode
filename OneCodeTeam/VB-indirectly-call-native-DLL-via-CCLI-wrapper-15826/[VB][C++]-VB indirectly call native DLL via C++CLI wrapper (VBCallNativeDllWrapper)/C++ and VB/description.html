<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,1:ImageSprite;/Areas/Epx/Themes/Msdn/Content:0,/Areas/Epx/Content/Css:1&amp;amp;hashKey=E7560C71640616C5057FAEACB58DCB00" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/2f95808e-ca34-4249-88ff-44fabe33cdc0Combined.css,1:LinkList,2:ImageSprite,2:SiteFeedbackLink;/Areas/Epx/Themes/Msdn/Content:0,/Areas/Epx/Themes/Base/Content:1,/Areas/Epx/Content/Css:2&amp;amp;hashKey=EEE39C2D6B93379FDAF50337BE99AF8C" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>VB indirectly call native DLL via C++/CLI wrapper (VBCallNativeDllWrapper)</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>VB indirectly call native DLL via C++/CLI wrapper (VBCallNativeDllWrapper)</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            .NET Framework
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Interop
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary Language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Last Updated</label>
                    <div id="LastUpdated">8/22/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/VBCallNativeDllWrapper-bd5175ca">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy Code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1><span style="font-family:新宋体">Console Application </span>(<span class="SpellE"><span style="font-family:新宋体">VBCallNativeDllWrapper</span></span>)</h1>
<h2>Introduction</h2>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
The code sample demonstrates calling the functions and classes exported by a native C&#43;&#43; DLL module from VB.NET code through C&#43;&#43;/CLI wrapper classes.
</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="">&nbsp; </span><span class="SpellE">VBCallNativeDllWrapper</span> (this .NET application)<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>--&gt;<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="SpellE">CppCLINativeDllWrapper</span> (the C&#43;&#43;/CLI wrapper)<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>--&gt;<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class="SpellE">CppDynamicLinkLibrary</span> (a native C&#43;&#43; DLL module)<span style="">
</span></p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style=""></span></p>
<h3>Demo</h3>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
The following steps walk through a demonstration of the .NET-native <span class="SpellE">
interop</span> sample.</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
Step1. After you successfully build the <span class="SpellE">CppDynamicLinkLibrary</span>,
<span class="SpellE">CppCLINativeDllWrapper</span>, and <span class="SpellE">
VBCallNativeDllWrapper</span> sample projects in Visual Studio 2008, you will get the applications: VBCallNativeDllWrapper.exe and two DLL files: CppCLINativeDllWrapper.dll and CppDynamicLinkLibrary.dll. Their relationship is that VBCallNativeDllWrapper.exe
 invokes CppCLINativeDllWrapper.dll, which further invokes functions and classes exported by CppDynamicLinkLibrary.dll.</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
Step2. Run <span class="SpellE">VBCallNativeDllWrapper</span> in a command prompt. The application should<span style="">
</span>print the following messages in the console. </p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; text-indent:9.0pt; line-height:normal; text-autospace:none">
</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; text-indent:9.0pt; line-height:normal; text-autospace:none">
<span style=""><img src="description/image.png" alt="" width="525" height="251" align="middle">
</span></p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
The messages indicate that <span class="SpellE">VBCallNativeDllWrapper</span> <span class="SpellE">
successfuly</span> loaded CppDynamicLinkLibrary.dll and invoked the functions (GetStringLength1, GetStringLength2, Max) and the class (<span class="SpellE">CSimpleObject</span>) exported by the native module.</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
NOTE: You may receive the following error if you run the debug build of the sample project on a system without the Visual Studio 2008 installed.
</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="">&nbsp;&nbsp;&nbsp; </span>Unhandled Exception: <span class="SpellE">
<a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.IO.FileLoadException.aspx"  title="Auto generated link to System.IO.FileLoadException">System.IO.FileLoadException</a></span>: Could not load file <span class="GramE">or<span style="">&nbsp;
</span>assembly</span> '<span class="SpellE">CppCLINativeDllWrapper</span>, Version=1.0.0.0, Culture=neutral,
<span class="SpellE">PublicKeyToken</span>=null' or one of its dependencies. This application
<span class="GramE">has<span style="">&nbsp; </span>failed</span> to start because the application configuration is incorrect.<span style="">&nbsp;
</span>Reinstalling the application may fix this problem. (Exception from HRESULT: 0x800736B1) File name:
<span class="SpellE">CppCLINativeDllWrapper</span>, Version=1.0.0.0, Culture=neutral<span class="GramE">,<span style="">&nbsp;
</span><span class="SpellE">PublicKeyToken</span></span>=null' ---&gt; <span class="SpellE">
<a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Runtime.InteropServices.COMException.aspx"  title="Auto generated link to System.Runtime.InteropServices.COMException">System.Runtime.InteropServices.COMException</a></span><span style="">&nbsp; </span>(0x800736B1): This application has failed to start because the application configuration is incorrect. Reinstalling the application may fix
<span class="GramE">this<span style="">&nbsp; </span>problem</span>. (Exception from HRESULT: 0x800736B1) at
<span class="SpellE"><span class="GramE">CSCallNativeDllWrapper.Program.Main</span></span><span class="GramE">(</span>String[]
<span class="SpellE">args</span>)</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
This is caused by the fact the debug build of <span class="SpellE">CppCLINativeDllWrapper</span> and
<span class="SpellE">CppDynamicLinkLibrary</span> depends on the Debug CRT which is only available in the development environments with Visual Studio 2008 installed. You must run the release build of the sample project in the non-development environment.<span style="">
</span></p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
</p>
<h3>Implementation</h3>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
</p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
Step1. Reference the C&#43;&#43;/CLI wrapper class library <span class="SpellE">CppCLINativeDllWrapper</span> in the VB.NET sample
<span class="SpellE">applicatino</span>. <span class="SpellE">CppCLINativeDllWrapper</span> wraps the functions and classes exported by the native C&#43;&#43; DLL
<span class="SpellE">CppDynamicLinkLibrary</span>.<span style=""> </span></p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style=""></span></p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
Step2. Call the .NET classes <span class="SpellE">CSimpleObjectWrapper</span> and
<span class="SpellE">NativeMethods</span> exposed by <span class="SpellE">CppCLINativeDllWrapper</span> to indirectly access the functions and classes exported by the native C&#43;&#43; DLL
<span class="SpellE">CppDynamicLinkLibrary</span>. For example, <span style="">
</span></p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style=""></span></p>
<p class="MsoNormal" style="margin-bottom:0cm; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style=""></span></p>
<p class="MsoNormal"><span style=""></span></p>
<p class="MsoNormal"><span style=""></span></p>
<h2>More Information</h2>
<p class="MsoListParagraphCxSpFirst" style="text-indent:5.0pt"><span style="font-family:Symbol"><span style="">&bull;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><a href="http://msdn.microsoft.com/en-us/library/2x8kf7zx.aspx">Using C&#43;&#43;
<span class="SpellE">Interop</span> (Implicit <span class="SpellE">PInvoke</span>)</a></p>
<p class="MsoListParagraphCxSpLast" style="text-indent:5.0pt"><span style="font-family:Symbol"><span style="">&bull;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><a href="http://msdn.microsoft.com/en-us/library/ms235281.aspx">How to: Wrap Native Class for Use by C#</a></p>
<p class="MsoNormal"></p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="description/3384444c-0fce-4538-886c-126c04fccfb7image.png">
</a></div>

</div>


    </div>
</body>
</html>
