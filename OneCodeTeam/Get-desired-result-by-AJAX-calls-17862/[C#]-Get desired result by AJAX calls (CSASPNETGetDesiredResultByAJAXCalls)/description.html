<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/67b74b86-a273-4ad7-9ed5-0f97276412eaCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Get desired result by AJAX calls (CSASPNETGetDesiredResultByAJAXCalls)</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Get desired result by AJAX calls (CSASPNETGetDesiredResultByAJAXCalls)</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            AJAX, ASP.NET
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            AJAX
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Web
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">7/22/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/CSASPNETGetDesiredResultByA-b311498b">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1><span style="">How to use Render event in ASP.NET page to return desired text results
</span>(<span class="SpellE"><span style="">CSASPNETGetDesiredResultByAJAXCalls</span></span>)</h1>
<h2>Introduction </h2>
<p class="MsoNormal">The sample code demonstrates how to use Render event in ASP.NET page's life cycle to return desired text results. Normally, developers may use Web Services, WCF services, ASHX generic handlers, static page methods or other methods to
 handle AJAX calls. These utilities are designed to meet requirements of specific purpose. Sometimes developers may need a simple and flexible way; so as to they can design their own format of data as the response to request. Some developers may use
<span class="SpellE">Response.Write</span> Method; they want to print out the string that is passed as the argument. But all they get is the long text with unwanted markups. This sample shows how to use built-in methods in page's life cycle to achieve this
 goal. It does not require other knowledge of components in ASP.NET. It also helps developers not coming from the ASP.NET world to understand how an
<span class="SpellE">aspx</span> page is designed to work.</p>
<h2>Running the Sample</h2>
<p class="MsoNormal">Please follow these demonstration steps below.</p>
<p class="MsoNormal">Step 1: Open the CSASPNETGetDesiredResultByAJAXCalls.sln.</p>
<p class="MsoNormal">Step 2: Right click Default.aspx and choose &quot;View in Browser&quot;.</p>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="font-size:9.5pt; font-family:Consolas"><img src="description/image.png" alt="" width="455" height="123" align="middle">
</span><span style="font-size:9.5pt; font-family:Consolas"></span></p>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="font-size:9.5pt; font-family:Consolas"></span></p>
<p class="MsoNormal">Step 3: Choose an item in drop-down list then click the button. You can also enter text to test output the specified text.</p>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="font-size:9.5pt; font-family:Consolas"><img src="description/0a6e69dc-81d6-4a34-82d7-da761e283d2aimage.png" alt="" width="603" height="194" align="middle">
<img src="description/afd61384-cc9d-4122-8c75-25b32244d338image.png" alt="" width="311" height="98" align="middle">
</span><span style="font-size:9.5pt; font-family:Consolas"></span></p>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="font-size:9.5pt; font-family:Consolas"></span></p>
<p class="MsoNormal">Step 4: Validation finished.</p>
<h2>Using the Code</h2>
<p class="MsoNormal">Code Logical: <span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>
</p>
<p class="MsoNormal"><span class="GramE">Step 1.</span> Create a C# &quot;ASP.NET Web Application&quot; in Visual Studio 2010/Visual Web Developer 2010. Name it as &quot;CSASPNETGetDesiredResultByAJAXCalls&quot;.</p>
<p class="MsoNormal"><span class="GramE">Step 2.</span> Modify the Default page as the following.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>HTML</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">html</span>
<pre class="hidden">
&lt;form id=&quot;form1&quot; runat=&quot;server&quot;&gt;
   You can enter some information:&lt;input type=&quot;text&quot; id=&quot;txt&quot; /&gt;<br>
   The type of data you need to return&lt;select id=&quot;drpType&quot;&gt;
       &lt;option value=&quot;1&quot;&gt;plain text&lt;/option&gt;
       &lt;option value=&quot;2&quot;&gt;JSON&lt;/option&gt;
       &lt;option value=&quot;3&quot;&gt;XML&lt;/option&gt;
   &lt;/select&gt;
   <br>
   &lt;input type=&quot;button&quot; value=&quot;Ajax Request&quot; onclick=&quot;AjaxRequest();&quot; /&gt;
   <hr>
   <div id="result">
   </div>
   &lt;/form&gt;

</pre>
<pre id="codePreview" class="html">
&lt;form id=&quot;form1&quot; runat=&quot;server&quot;&gt;
   You can enter some information:&lt;input type=&quot;text&quot; id=&quot;txt&quot; /&gt;<br>
   The type of data you need to return&lt;select id=&quot;drpType&quot;&gt;
       &lt;option value=&quot;1&quot;&gt;plain text&lt;/option&gt;
       &lt;option value=&quot;2&quot;&gt;JSON&lt;/option&gt;
       &lt;option value=&quot;3&quot;&gt;XML&lt;/option&gt;
   &lt;/select&gt;
   <br>
   &lt;input type=&quot;button&quot; value=&quot;Ajax Request&quot; onclick=&quot;AjaxRequest();&quot; /&gt;
   <hr>
   <div id="result">
   </div>
   &lt;/form&gt;

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal" style="">Step 3. Create an instance of XMLHttpRequest.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>JavaScript</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">js</span>
<pre class="hidden">
var xmlHttp;
     function createXMLHttpRequest() {
         if (window.ActiveXObject) {
             xmlHttp = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);
         }
         else if (window.XMLHttpRequest) {
             xmlHttp = new XMLHttpRequest();
         }
     }

</pre>
<pre id="codePreview" class="js">
var xmlHttp;
     function createXMLHttpRequest() {
         if (window.ActiveXObject) {
             xmlHttp = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);
         }
         else if (window.XMLHttpRequest) {
             xmlHttp = new XMLHttpRequest();
         }
     }

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal" style="">Create the Callback method.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>JavaScript</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">js</span>
<pre class="hidden">
//Callback method 
function onSuccessCallBack() {
    if (xmlHttp.readyState == 4) //4 represent Complete 
    {
        if (xmlHttp.status == 200) {
            switch (document.getElementById(&quot;drpType&quot;).value) {
                case &quot;1&quot;: //For plain text
                    document.getElementById(&quot;result&quot;).innerHTML = xmlHttp.responseText;
                    break;
                case &quot;2&quot;: //For JSON
                    var result = xmlHttp.responseText;
                    var json = eval(&quot;(&quot; &#43; result &#43; &quot;)&quot;);
                    alert(json.hello);
                    alert(json.face);
                    break;
                case &quot;3&quot;: //For XML                             
                    // Get XML DOM object
                    var xmlDOM = xmlHttp.responseXML;
                    // Obtain the root of the XML document
                    var xmlRoot = xmlDOM.documentElement;
                    try {
                        var xmlItem = xmlRoot.getElementsByTagName(&quot;hello&quot;);
                        alert(&quot;responseXML's value: &quot; &#43; xmlItem[0].firstChild.data);
                        var xmlItem = xmlRoot.getElementsByTagName(&quot;world&quot;);
                        alert(&quot;responseXML's value: &quot; &#43; xmlItem[0].firstChild.data);
                    }
                    catch (e) {
                        alert(e.message);
                    }
                    break;
                default:
            }
        }
    }
} 

</pre>
<pre id="codePreview" class="js">
//Callback method 
function onSuccessCallBack() {
    if (xmlHttp.readyState == 4) //4 represent Complete 
    {
        if (xmlHttp.status == 200) {
            switch (document.getElementById(&quot;drpType&quot;).value) {
                case &quot;1&quot;: //For plain text
                    document.getElementById(&quot;result&quot;).innerHTML = xmlHttp.responseText;
                    break;
                case &quot;2&quot;: //For JSON
                    var result = xmlHttp.responseText;
                    var json = eval(&quot;(&quot; &#43; result &#43; &quot;)&quot;);
                    alert(json.hello);
                    alert(json.face);
                    break;
                case &quot;3&quot;: //For XML                             
                    // Get XML DOM object
                    var xmlDOM = xmlHttp.responseXML;
                    // Obtain the root of the XML document
                    var xmlRoot = xmlDOM.documentElement;
                    try {
                        var xmlItem = xmlRoot.getElementsByTagName(&quot;hello&quot;);
                        alert(&quot;responseXML's value: &quot; &#43; xmlItem[0].firstChild.data);
                        var xmlItem = xmlRoot.getElementsByTagName(&quot;world&quot;);
                        alert(&quot;responseXML's value: &quot; &#43; xmlItem[0].firstChild.data);
                    }
                    catch (e) {
                        alert(e.message);
                    }
                    break;
                default:
            }
        }
    }
} 

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal" style="">Create the Deal method.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>JavaScript</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">js</span>
<pre class="hidden">
     //Deal method 
     function AjaxRequest() {
         createXMLHttpRequest();
         var url = &quot;example.aspx?str=&quot; &#43; document.getElementById(&quot;txt&quot;).value &#43; &quot;&type=&quot; &#43; document.getElementById(&quot;drpType&quot;).value;
         xmlHttp.open(&quot;GET&quot;, url, false);
         xmlHttp.onreadystatechange = onSuccessCallBack;
         xmlHttp.send(null);
     }
     } 

</pre>
<pre id="codePreview" class="js">
     //Deal method 
     function AjaxRequest() {
         createXMLHttpRequest();
         var url = &quot;example.aspx?str=&quot; &#43; document.getElementById(&quot;txt&quot;).value &#43; &quot;&type=&quot; &#43; document.getElementById(&quot;drpType&quot;).value;
         xmlHttp.open(&quot;GET&quot;, url, false);
         xmlHttp.onreadystatechange = onSuccessCallBack;
         xmlHttp.send(null);
     }
     } 

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="font-size:9.5pt; font-family:Consolas"></span></p>
<p class="MsoNormal" style="">Step 4. Call the function in the button's onclick event.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>HTML</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">html</span>
<pre class="hidden">
&lt;input type=&quot;button&quot; value=&quot;Ajax Request&quot; onclick=&quot;AjaxRequest();&quot; /&gt;

</pre>
<pre id="codePreview" class="html">
&lt;input type=&quot;button&quot; value=&quot;Ajax Request&quot; onclick=&quot;AjaxRequest();&quot; /&gt;

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal" style=""><br>
Step 5. Add a new Web Form and name it as &quot;example.aspx&quot;.This ASPX page is used to handle the Ajax request and return data.</p>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="font-size:9.5pt; font-family:Consolas"></span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
protected override void Render(HtmlTextWriter output)
      {
          //Query String
          string strText = Request.QueryString[&quot;str&quot;];
          string type = Request.QueryString[&quot;type&quot;];
          //Output String
          string strOutput = string.Empty;


          //Returns the appropriate data type by Query String
          switch (type)
          {
              case &quot;1&quot;://For plain text, &quot;hello world&quot; or some infomation you type
                  if (string.IsNullOrEmpty(strText))
                  {
                      strText = &quot;hello world&quot;;
                  }
                  strOutput = strText;
                  break;
              case &quot;2&quot;: //For JSON, {&quot;hello&quot;: &quot;world&quot;}                    
                  strOutput = &quot;{\&quot;hello\&quot;: \&quot;world\&quot;,\&quot;face\&quot;: \&quot;smile\&quot;}&quot;;
                  break;
              case &quot;3&quot;: //For XML, &lt;hello&gt;Hello&lt;/hello&gt;&lt;world&gt;World&lt;/word&gt;
                  strOutput = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;GB2312\&quot;?&gt;&lt;root&gt;&lt;hello&gt;Hello&lt;/hello&gt;&lt;world&gt;World&lt;/world&gt;&lt;/root&gt;&quot;;
                  break;
              default:
                  break;
          }
          //Set the HTTP MIME type of the output stream
          Response.ContentType = &quot;text/xml&quot;;
          //Output stream
          output.Write(strOutput);
      }

</pre>
<pre id="codePreview" class="csharp">
protected override void Render(HtmlTextWriter output)
      {
          //Query String
          string strText = Request.QueryString[&quot;str&quot;];
          string type = Request.QueryString[&quot;type&quot;];
          //Output String
          string strOutput = string.Empty;


          //Returns the appropriate data type by Query String
          switch (type)
          {
              case &quot;1&quot;://For plain text, &quot;hello world&quot; or some infomation you type
                  if (string.IsNullOrEmpty(strText))
                  {
                      strText = &quot;hello world&quot;;
                  }
                  strOutput = strText;
                  break;
              case &quot;2&quot;: //For JSON, {&quot;hello&quot;: &quot;world&quot;}                    
                  strOutput = &quot;{\&quot;hello\&quot;: \&quot;world\&quot;,\&quot;face\&quot;: \&quot;smile\&quot;}&quot;;
                  break;
              case &quot;3&quot;: //For XML, &lt;hello&gt;Hello&lt;/hello&gt;&lt;world&gt;World&lt;/word&gt;
                  strOutput = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;GB2312\&quot;?&gt;&lt;root&gt;&lt;hello&gt;Hello&lt;/hello&gt;&lt;world&gt;World&lt;/world&gt;&lt;/root&gt;&quot;;
                  break;
              default:
                  break;
          }
          //Set the HTTP MIME type of the output stream
          Response.ContentType = &quot;text/xml&quot;;
          //Output stream
          output.Write(strOutput);
      }

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="font-size:9.5pt; font-family:Consolas"></span></p>
<p class="MsoNormal" style="">Step 6. Build the application and you can debug it.</p>
<p class="MsoNormal" style=""><span class="SpellE">Control.Render</span> Method</p>
<p class="MsoNormal" style=""><a href="http://msdn.microsoft.com/en-us/library/system.web.ui.control.render(VS.80).aspx">http://msdn.microsoft.com/en-us/library/system.web.ui.control.render(VS.80).aspx</a></p>
<p class="MsoNormal" style=""></p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="description/95e3bc78-76ea-4f7c-8b0e-445ca740f249image.png">
</a></div>

</div>


    </div>
</body>
</html>
