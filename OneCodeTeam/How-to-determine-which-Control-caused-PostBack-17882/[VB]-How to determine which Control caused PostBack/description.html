<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,1:ImageSprite;/Areas/Epx/Themes/Msdn/Content:0,/Areas/Epx/Content/Css:1&amp;amp;hashKey=E7560C71640616C5057FAEACB58DCB00" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/d3400f39-92d4-48d8-84fa-1b85f57d841cCombined.css,1:LinkList,2:ImageSprite,2:SiteFeedbackLink;/Areas/Epx/Themes/Msdn/Content:0,/Areas/Epx/Themes/Base/Content:1,/Areas/Epx/Content/Css:2&amp;amp;hashKey=EEE39C2D6B93379FDAF50337BE99AF8C" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>How to determine which Control caused PostBack</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>How to determine which Control caused PostBack</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            ASP.NET
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Postback
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Web
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary Language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Last Updated</label>
                    <div id="LastUpdated">7/5/2013</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/VBASPNETControlCausePostbac-75a0bace">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy Code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Determine which control causes PostBack event on an ASP.NET page (VBASPNETControlCausePostback)</h1>
<h2>Introduction</h2>
<p class="MsoNormal">The sample code demonstrates how to create a web application that can determine which control causes the postback event on an Asp.net page. Sometimes, we need to perform some specific actions based on the specific control which causes
 the postback. For example, we can get controls' id property that and do some operations, such as set TextBox's text with ViewState variable. In this sample, we can also transfer some data through postbacks.
</p>
<h2>Running the Sample </h2>
<p class="MsoNormal">Please follow these demonstration steps below. </p>
<p class="MsoNormal">Step 1:&nbsp;Open the VBASPNETControlCausePostback.sln. Expand the
<a name="OLE_LINK1"></a><a name="OLE_LINK2"><span style="">VBASPNETControlCausePostback
</span></a>web application and press Ctrl &#43; F5 to show the Default.aspx. </p>
<p class="MsoNormal">Step 2: We will see only some html controls on the page, two buttons, a checkbox and a Dropdownlist. In this page, we have added JavaScript functions that can cause postback event, so just click them (or select an item in the Dropdownlist
 control) for a try.</p>
<p class="MsoNormal"><span style=""><img src="description/image.png" alt="" width="533" height="484" align="middle">
</span></p>
<p class="MsoNormal">Step 3:<span style="">&nbsp; </span>When you click the Button A, you can find the page is refreshed and some information has been added at the bottom of the page.</p>
<p class="MsoNormal"><span style=""><img src="description/1c7500b2-d54f-489a-bb0c-b1092ac479fbimage.png" alt="" width="533" height="484" align="middle">
</span></p>
<p class="MsoNormal">Step 4: You can click other controls, the application can find which control causes the postback event and then display transfer data, for example, if you click CheckBox C:<span style="">
</span></p>
<p class="MsoNormal"><span style=""><img src="description/51c4ecf2-9c55-4676-8897-9c82d33e7356image.png" alt="" width="533" height="484" align="middle">
</span></p>
<p class="MsoNormal">Step 5: View the Default2.aspx page with above steps, too. The Default2 web page shows how to make this functions working with Server controls (Asp.net controls).</p>
<p class="MsoNormal">Step 6: Validation finished.</p>
<h2>Using the Code</h2>
<p class="MsoNormal">Code Logical: </p>
<p class="MsoNormal">Step 1. Create a VB.NET &quot;ASP.NET Empty Web Application&quot; in Visual Studio 2008 or Visual Web Developer 2008. Name it as &quot;VBASPNETControlCausePostback &quot;. Add two webform pages and name them as &quot;Default.aspx&quot;
 and &quot;Default2.aspx. </p>
<p class="MsoNormal">Step 2. We need to use JavaScript functions to cause postback function with two parameters, __EVENTTARGET and __EVENTARGUMENT, the former one is controls' id property, and the latter one is postback data, you can add the message as you
 like when you try to call this function. The Default page and Default2 page are different, Default page includes some HTML controls that we have to add __doPostBack function by ourselves, and we also need to manager the control's state. HTML control will lost
 their states while crossing postback events, for example, the CheckBox's checked property will recover to initial state if you do not handle their state.</p>
<h3>The following code shows how to persist controls' states when page is loading.</h3>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>JavaScript</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">js</span>
<pre class="hidden">
&lt;script type=&quot;text/javascript&quot;&gt;
    function load() {
        var checkbox = document.getElementById(&quot;chkC&quot;);
        var hiddenCheckBox = document.getElementById(&quot;checkbox&quot;);
        if (hiddenCheckBox.value == &quot;true&quot;) {
            checkbox.checked = true;
        }
        else if (hiddenCheckBox.value == &quot;false&quot;) {
            checkbox.checked = false;
        }
        else {
            checkbox.checked = false;
        }
        var dropdownlist = document.getElementById(&quot;ddlD&quot;);
        var hiddenDropdownlist = document.getElementById(&quot;dropdownlist&quot;);
        var index = parseInt(hiddenDropdownlist.value);
        dropdownlist.selectedIndex = index;
    }
&lt;/script&gt;

</pre>
<pre id="codePreview" class="js">
&lt;script type=&quot;text/javascript&quot;&gt;
    function load() {
        var checkbox = document.getElementById(&quot;chkC&quot;);
        var hiddenCheckBox = document.getElementById(&quot;checkbox&quot;);
        if (hiddenCheckBox.value == &quot;true&quot;) {
            checkbox.checked = true;
        }
        else if (hiddenCheckBox.value == &quot;false&quot;) {
            checkbox.checked = false;
        }
        else {
            checkbox.checked = false;
        }
        var dropdownlist = document.getElementById(&quot;ddlD&quot;);
        var hiddenDropdownlist = document.getElementById(&quot;dropdownlist&quot;);
        var index = parseInt(hiddenDropdownlist.value);
        dropdownlist.selectedIndex = index;
    }
&lt;/script&gt;

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<h3>The following code shows how to cause postback event and save control's current state.</h3>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>JavaScript</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">js</span>
<pre class="hidden">
&lt;script type=&quot;text/javascript&quot;&gt;
      var theForm = document.forms['form1'];
      if (!theForm) {
          theForm = document.form1;


          function PostBack(controlName, postbackData) {
              var name = controlName;
              var data = postbackData;
              var checkbox = document.getElementById(&quot;chkC&quot;);
              var hiddenCheckBox = document.getElementById(&quot;checkbox&quot;);
              var dropdownlist = document.getElementById(&quot;ddlD&quot;);
              var hiddenDropdownlist = document.getElementById(&quot;dropdownlist&quot;);
              if (checkbox.checked) {
                  hiddenCheckBox.value = &quot;true&quot;;
              }
              else {
                  hiddenCheckBox.value = &quot;false&quot;;
              }
              hiddenDropdownlist.value = dropdownlist.selectedIndex;
              __doPostBack(name, data);
          }




      }
      function __doPostBack(eventTarget, eventArgument) {
          theForm.__EVENTTARGET.value = eventTarget;
          theForm.__EVENTARGUMENT.value = eventArgument;
          theForm.submit();
      }
  &lt;/script&gt;

</pre>
<pre id="codePreview" class="js">
&lt;script type=&quot;text/javascript&quot;&gt;
      var theForm = document.forms['form1'];
      if (!theForm) {
          theForm = document.form1;


          function PostBack(controlName, postbackData) {
              var name = controlName;
              var data = postbackData;
              var checkbox = document.getElementById(&quot;chkC&quot;);
              var hiddenCheckBox = document.getElementById(&quot;checkbox&quot;);
              var dropdownlist = document.getElementById(&quot;ddlD&quot;);
              var hiddenDropdownlist = document.getElementById(&quot;dropdownlist&quot;);
              if (checkbox.checked) {
                  hiddenCheckBox.value = &quot;true&quot;;
              }
              else {
                  hiddenCheckBox.value = &quot;false&quot;;
              }
              hiddenDropdownlist.value = dropdownlist.selectedIndex;
              __doPostBack(name, data);
          }




      }
      function __doPostBack(eventTarget, eventArgument) {
          theForm.__EVENTTARGET.value = eventTarget;
          theForm.__EVENTARGUMENT.value = eventArgument;
          theForm.submit();
      }
  &lt;/script&gt;

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal"></p>
<p class="MsoNormal"><b style="">[NOTE] </b></p>
<p class="MsoNormal"><b style="">The former part of JavaScript functions can be added in the &lt;Head&gt; tag because page's onload event will call this function, so you need to write the &lt;body&gt; HTML code like this: &lt;body onload=&quot;load();&quot;&gt;.
</b></p>
<p class="MsoNormal"><b style="">The latter part of JavaScript functions must be added after the &lt;form&gt; tag because the JavaScript function will get form and invoke form.submit() function, if you add these JavaScript code in the &lt;Head&gt; tag, the
 theForm variable will be null value. </b></p>
<p class="MsoNormal">Step 3. Then you can add HTML controls on the page like sample's Default.aspx, after that, we can write some VB.NET code in code-behind file for retrieving control id and postback data.</p>
<h3>The following code is use to get JavaScript arguments across postback event. </h3>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>VB</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">vb</span>
<pre class="hidden">
Protected Sub Page_Load(ByVal sender As Object, ByVal e As <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.EventArgs.aspx"  title="Auto generated link to System.EventArgs">System.EventArgs</a>) Handles Me.Load
    If Page.IsPostBack Then
        Dim builder As New StringBuilder()
        If Not [String].IsNullOrEmpty(Request(&quot;__EVENTTARGET&quot;)) AndAlso Not [String].IsNullOrEmpty(Request(&quot;__EVENTARGUMENT&quot;)) Then
            Dim target As String = TryCast(Request(&quot;__EVENTTARGET&quot;), String)
            Dim argument As String = TryCast(Request(&quot;__EVENTARGUMENT&quot;), String)
            builder.Append(&quot;Cause postback control:&quot;)
            builder.Append(&quot;<br>&quot;)
            builder.Append(target)
            builder.Append(&quot;<br>&quot;)
            builder.Append(&quot;<br>&quot;)
            builder.Append(&quot;Postback data:&quot;)
            builder.Append(&quot;<br>&quot;)
            builder.Append(argument)
            lbMessage.Text = builder.ToString()


        End If
    End If
End Sub

</pre>
<pre id="codePreview" class="vb">
Protected Sub Page_Load(ByVal sender As Object, ByVal e As <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.EventArgs.aspx"  title="Auto generated link to System.EventArgs">System.EventArgs</a>) Handles Me.Load
    If Page.IsPostBack Then
        Dim builder As New StringBuilder()
        If Not [String].IsNullOrEmpty(Request(&quot;__EVENTTARGET&quot;)) AndAlso Not [String].IsNullOrEmpty(Request(&quot;__EVENTARGUMENT&quot;)) Then
            Dim target As String = TryCast(Request(&quot;__EVENTTARGET&quot;), String)
            Dim argument As String = TryCast(Request(&quot;__EVENTARGUMENT&quot;), String)
            builder.Append(&quot;Cause postback control:&quot;)
            builder.Append(&quot;<br>&quot;)
            builder.Append(target)
            builder.Append(&quot;<br>&quot;)
            builder.Append(&quot;<br>&quot;)
            builder.Append(&quot;Postback data:&quot;)
            builder.Append(&quot;<br>&quot;)
            builder.Append(argument)
            lbMessage.Text = builder.ToString()


        End If
    End If
End Sub

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal"></p>
<p class="MsoNormal">Step 4: In Default2 web page, we use Server buttons instead of HTML controls, the page will generate __doPostBack function automatically, so you can use __doPostBack directly and needn't to maintain the control's state.</p>
<p class="MsoNormal">Step 5. Build the application and you can debug it.</p>
<p class="MsoNormal"></p>
<h2>More Information</h2>
<p class="MsoNormal"><a href="http://msdn.microsoft.com/en-us/library/system.web.ui.page.ispostback.aspx">Page.IsPostBack Property</a></p>
<p class="MsoNormal"></p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="description/b889d079-f6e3-4e60-ae88-9824f8a95a19image.png">
</a></div>

</div>


    </div>
</body>
</html>
