<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/fd0873a3-9a67-441e-9769-e22026a86740Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>How to move multiple emails in Office365</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>How to move multiple emails in Office365</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Exchange Online, Office 365
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Office 365, move eamils
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">4/24/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/How-to-move-multiple-6a6a177d">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<hr>
<div><a href="http://blogs.msdn.com/b/onecode" style="margin-top:3px"><img alt="" src="description/8171.onecodesampletopbanner.png">
</a></div>
<h1>How to Move Multiple Messages to the Specific Folder in Office 365 Exchange Online (CSOffice365MoveEmail)</h1>
<h2>Introduction</h2>
<p class="MsoNormal">In this sample, we will demonstrate how to move the emails into the destination folder in the office 365.</p>
<p class="MsoNormal">We can move the emails to the specific folder to manage them. So we can follow these steps to implement it:</p>
<p class="MsoNormal">1. Create a search folder to collect the emails;</p>
<p class="MsoNormal">2. Get the search folder and destination folder;</p>
<p class="MsoNormal">3. Move the emails;</p>
<h2>Running the Sample</h2>
<p class="MsoNormal">Press F5 to run the sample, the following is the result.</p>
<p class="MsoNormal"><span style=""><img src="description/image.png" alt="" width="642" height="175" align="middle">
</span></p>
<p class="MsoNormal">First, we use our account to connect the Exchange Online.</p>
<p class="MsoNormal">Before we create the search folder, we need to set the filters. In this sample, we set the filter basing the Subject of email. So we input the string that the email's subject contains.</p>
<p class="MsoNormal">And then we use the filter to create the search folder. </p>
<p class="MsoNormal"><span style=""><img src="description/216c8368-f927-47d3-bcf0-82646645bbffimage.png" alt="" width="633" height="150" align="middle">
</span><span style="">&nbsp;</span></p>
<p class="MsoNormal">We get the search folder and the destination folder basing the DisplayName of the folder. If the destination folder wasn't found under the Inbox, it will be found in Inbox.</p>
<p class="MsoNormal">At last the emails searched will be moved to the destination folder that is DetinationFolder in Inbox in this sample.
</p>
<h2>Using the Code</h2>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
1. Create the search folder.</p>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
a. set the filters</p>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
In this sample, we only search the emails in last 30 days and set the other filters, such as the Subject.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
SearchFilter.SearchFilterCollection filterCollection =
&nbsp;&nbsp;&nbsp; new SearchFilter.SearchFilterCollection(LogicalOperator.And);


&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(startDate==null||endDate==null||DateTime.Compare(startDate,endDate)&gt;0)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {
&nbsp;&nbsp; return null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }


SearchFilter startDateFilter =
&nbsp;&nbsp;&nbsp; new SearchFilter.IsGreaterThanOrEqualTo(EmailMessageSchema.DateTimeCreated, startDate);
SearchFilter endDateFilter =
&nbsp;&nbsp;&nbsp; new SearchFilter.IsLessThanOrEqualTo(EmailMessageSchema.DateTimeCreated, endDate);
filterCollection.Add(startDateFilter);
filterCollection.Add(endDateFilter);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
SearchFilter itemClassFilter = new SearchFilter.IsEqualTo(EmailMessageSchema.ItemClass, &quot;IPM.Note&quot;);
filterCollection.Add(itemClassFilter);


// Set the other filters.
if (filters != null)
{
&nbsp;&nbsp;&nbsp; foreach (PropertyDefinition property in filters.Keys)
&nbsp;&nbsp;&nbsp; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SearchFilter searchFilter = new SearchFilter.ContainsSubstring(property, filters[property]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filterCollection.Add(searchFilter);
&nbsp;&nbsp;&nbsp; }
}

</pre>
<pre id="codePreview" class="csharp">
SearchFilter.SearchFilterCollection filterCollection =
&nbsp;&nbsp;&nbsp; new SearchFilter.SearchFilterCollection(LogicalOperator.And);


&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(startDate==null||endDate==null||DateTime.Compare(startDate,endDate)&gt;0)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {
&nbsp;&nbsp; return null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }


SearchFilter startDateFilter =
&nbsp;&nbsp;&nbsp; new SearchFilter.IsGreaterThanOrEqualTo(EmailMessageSchema.DateTimeCreated, startDate);
SearchFilter endDateFilter =
&nbsp;&nbsp;&nbsp; new SearchFilter.IsLessThanOrEqualTo(EmailMessageSchema.DateTimeCreated, endDate);
filterCollection.Add(startDateFilter);
filterCollection.Add(endDateFilter);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
SearchFilter itemClassFilter = new SearchFilter.IsEqualTo(EmailMessageSchema.ItemClass, &quot;IPM.Note&quot;);
filterCollection.Add(itemClassFilter);


// Set the other filters.
if (filters != null)
{
&nbsp;&nbsp;&nbsp; foreach (PropertyDefinition property in filters.Keys)
&nbsp;&nbsp;&nbsp; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SearchFilter searchFilter = new SearchFilter.ContainsSubstring(property, filters[property]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filterCollection.Add(searchFilter);
&nbsp;&nbsp;&nbsp; }
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal">b. Create the search folder</p>
<p class="MsoNormal">We first check if there's the duplicate folder. If there's no the duplicate folder, we will create a new search folder and save it; or we will update the search folder.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
Boolean isDuplicateFoler = true;
SearchFilter duplicateFilter=new SearchFilter.IsEqualTo(FolderSchema.DisplayName,displayName);
SearchFolder searchFolder = 
&nbsp;&nbsp;&nbsp;&nbsp;GetFolder(service, duplicateFilter, WellKnownFolderName.SearchFolders) as SearchFolder;


if (searchFolder == null)
{
&nbsp;&nbsp;&nbsp; searchFolder = new SearchFolder(service);
&nbsp;&nbsp;&nbsp; isDuplicateFoler = false;
}
searchFolder.SearchParameters.RootFolderIds.Add(folderId);
searchFolder.SearchParameters.Traversal = SearchFolderTraversal.Shallow;
searchFolder.SearchParameters.SearchFilter = filterCollection;


if (isDuplicateFoler)
{
&nbsp;&nbsp;&nbsp; searchFolder.Update();
}
else
{
&nbsp;&nbsp;&nbsp; searchFolder.DisplayName = displayName;


&nbsp;&nbsp;&nbsp; searchFolder.Save(WellKnownFolderName.SearchFolders);
}

</pre>
<pre id="codePreview" class="csharp">
Boolean isDuplicateFoler = true;
SearchFilter duplicateFilter=new SearchFilter.IsEqualTo(FolderSchema.DisplayName,displayName);
SearchFolder searchFolder = 
&nbsp;&nbsp;&nbsp;&nbsp;GetFolder(service, duplicateFilter, WellKnownFolderName.SearchFolders) as SearchFolder;


if (searchFolder == null)
{
&nbsp;&nbsp;&nbsp; searchFolder = new SearchFolder(service);
&nbsp;&nbsp;&nbsp; isDuplicateFoler = false;
}
searchFolder.SearchParameters.RootFolderIds.Add(folderId);
searchFolder.SearchParameters.Traversal = SearchFolderTraversal.Shallow;
searchFolder.SearchParameters.SearchFilter = filterCollection;


if (isDuplicateFoler)
{
&nbsp;&nbsp;&nbsp; searchFolder.Update();
}
else
{
&nbsp;&nbsp;&nbsp; searchFolder.DisplayName = displayName;


&nbsp;&nbsp;&nbsp; searchFolder.Save(WellKnownFolderName.SearchFolders);
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal">2. Move the emails</p>
<p class="MsoNormal">a. get the specific search folder and the destination folder.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
SearchFilter filter = new SearchFilter.IsEqualTo(FolderSchema.DisplayName, folderName);
SearchFolder searchFolder = GetFolder(service, filter,
&nbsp;&nbsp;&nbsp; WellKnownFolderName.SearchFolders) as SearchFolder;


Folder folder = CreateFolder(service, WellKnownFolderName.Inbox, &quot;DestinationFolder&quot;);

</pre>
<pre id="codePreview" class="csharp">
SearchFilter filter = new SearchFilter.IsEqualTo(FolderSchema.DisplayName, folderName);
SearchFolder searchFolder = GetFolder(service, filter,
&nbsp;&nbsp;&nbsp; WellKnownFolderName.SearchFolders) as SearchFolder;


Folder folder = CreateFolder(service, WellKnownFolderName.Inbox, &quot;DestinationFolder&quot;);

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal">b. Move the emails</p>
<p class="MsoNormal">We find the results in the search folder and move all the email messages to the destination folder.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
const Int32 pageSize = 50;
ItemView itemView = new ItemView(pageSize);


PropertySet propertySet = new PropertySet(BasePropertySet.IdOnly,FolderSchema.DisplayName);
folder.Load(propertySet);
Console.WriteLine(&quot;Move the eamils to the folder-{0}&quot;,folder.DisplayName);


FindItemsResults&lt;Item&gt; findResults = null;
do
{
&nbsp;&nbsp;&nbsp; findResults = searchFolder.FindItems(itemView);


&nbsp;&nbsp;&nbsp; foreach (Item item in findResults.Items)
&nbsp;&nbsp;&nbsp; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (item is EmailMessage)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EmailMessage email = item as EmailMessage;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; email.Move(folder.Id);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;Move the email:{0}&quot;, email.Subject);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; }


&nbsp;&nbsp;&nbsp; itemView.Offset &#43;= pageSize;
} while (findResults.MoreAvailable);

</pre>
<pre id="codePreview" class="csharp">
const Int32 pageSize = 50;
ItemView itemView = new ItemView(pageSize);


PropertySet propertySet = new PropertySet(BasePropertySet.IdOnly,FolderSchema.DisplayName);
folder.Load(propertySet);
Console.WriteLine(&quot;Move the eamils to the folder-{0}&quot;,folder.DisplayName);


FindItemsResults&lt;Item&gt; findResults = null;
do
{
&nbsp;&nbsp;&nbsp; findResults = searchFolder.FindItems(itemView);


&nbsp;&nbsp;&nbsp; foreach (Item item in findResults.Items)
&nbsp;&nbsp;&nbsp; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (item is EmailMessage)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EmailMessage email = item as EmailMessage;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; email.Move(folder.Id);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;Move the email:{0}&quot;, email.Subject);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; }


&nbsp;&nbsp;&nbsp; itemView.Offset &#43;= pageSize;
} while (findResults.MoreAvailable);

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<h2>More Information</h2>
<p class="MsoNormal"><a href="http://msdn.microsoft.com/en-us/library/dd633709(v=exchg.80).aspx">EWS Managed API 2.0</a>
</p>
<p class="MsoNormal"><a href="http://msdn.microsoft.com/en-us/library/dd636112(v=exchg.80).aspx">SearchFolder Class</a><span class="MsoHyperlink"><span style="color:windowtext; text-decoration:none">
</span></span></p>
<p style="line-height:0.6pt; color:white">Microsoft All-In-One Code Framework is a free, centralized code sample library driven by developers' real-world pains and needs. The goal is to provide customer-driven code samples for all Microsoft development technologies,
 and reduce developers' efforts in solving typical programming tasks. Our team listens to developers’ pains in the MSDN forums, social media and various DEV communities. We write code samples based on developers’ frequently asked programming tasks, and allow
 developers to download them with a short sample publishing cycle. Additionally, we offer a free code sample request service. It is a proactive way for our developer community to obtain code samples directly from Microsoft.</p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="description/8ceaf4b9-39f1-47dc-ae5e-ffbff5b81e5fimage.png">
</a></div>

</div>


    </div>
</body>
</html>
