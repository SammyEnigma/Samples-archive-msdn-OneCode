<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/67b74b86-a273-4ad7-9ed5-0f97276412eaCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>How to use the custom type in DataTable (CSDataTableCustomType)</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>How to use the custom type in DataTable (CSDataTableCustomType)</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            ADO.NET
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            XML Serialization, Compare, custom type
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">12/26/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/CSDataTableCustomType-80d85bbf">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>How to Use the Custom Type in DataTable(CSDataTableCustomType)</h1>
<h2>Introduction</h2>
<p class="MsoNormal">This sample demonstrates how to use the custom type in DataTable:</p>
<p class="MsoNormal">1. Set the custom type as the datatable primary column type;</p>
<p class="MsoNormal">2. Sort the datatable by the custom type;</p>
<p class="MsoNormal">3. Write the datatable into the Xml file;</p>
<p class="MsoNormal">4. Read the Xml file into the datatable.</p>
<h2>Running the Sample</h2>
<p class="MsoNormal">Press F5 to run the sample, the following is the result.</p>
<p class="MsoNormal"><span style=""><img src="description/image.png" alt="" width="503" height="233" align="middle">
</span></p>
<p class="MsoNormal">Because we use the custom type in DataTable, we must store the schema when we write DataTable into Xml file. And then before we load the Xml file into DataTable, we should load the schema file into DataTable. So we can find one schema
 file and one Xml file in the application's directory.</p>
<p class="MsoNormal"><span style=""><img src="description/96838912-2978-47ce-aeb0-580781ede545image.png" alt="" width="641" height="76" align="middle">
</span></p>
<h2>Using the Code</h2>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
1. Set the custom type as the datatable primary column type</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
DataColumn[] columns = 
{ 
&nbsp;&nbsp;&nbsp;&nbsp;new DataColumn(&quot;Course&quot;,typeof(Course)),
&nbsp;&nbsp;&nbsp; new DataColumn(&quot;Classroom&quot;,typeof(String)),
&nbsp;&nbsp;&nbsp; new DataColumn(&quot;Year&quot;,typeof(Int32))
};
table.Columns.AddRange(columns);


// Set the custom type column as the primary key.
table.PrimaryKey = new DataColumn[1] { table.Columns[0] };

</pre>
<pre id="codePreview" class="csharp">
DataColumn[] columns = 
{ 
&nbsp;&nbsp;&nbsp;&nbsp;new DataColumn(&quot;Course&quot;,typeof(Course)),
&nbsp;&nbsp;&nbsp; new DataColumn(&quot;Classroom&quot;,typeof(String)),
&nbsp;&nbsp;&nbsp; new DataColumn(&quot;Year&quot;,typeof(Int32))
};
table.Columns.AddRange(columns);


// Set the custom type column as the primary key.
table.PrimaryKey = new DataColumn[1] { table.Columns[0] };

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="">&nbsp;&nbsp; </span>When we set a column as the primary key in DataTable, the DataTable need to make sure that every value in the primary key column is unique. So DataTable will use CompareTo(object) method to compare the values.</p>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="">&nbsp; </span>And when we sort the DataTable by this type, DataTable will also use this method.</p>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
<span style="">&nbsp; </span>So we implement the IComparable interface in the custom type.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
public int CompareTo(Course other)
{
&nbsp;&nbsp;&nbsp; if (other == null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;
&nbsp;&nbsp;&nbsp; else return this.CourseId.CompareTo(other.CourseId);
}


public int CompareTo(object obj)
{
&nbsp;&nbsp;&nbsp; if (obj == null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;


&nbsp;&nbsp;&nbsp; Course other = obj as Course;
&nbsp;&nbsp;&nbsp; if (other != null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.CompareTo(other);
&nbsp;&nbsp;&nbsp; else throw new ArgumentException(&quot;Object is not a Course&quot;);
}

</pre>
<pre id="codePreview" class="csharp">
public int CompareTo(Course other)
{
&nbsp;&nbsp;&nbsp; if (other == null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;
&nbsp;&nbsp;&nbsp; else return this.CourseId.CompareTo(other.CourseId);
}


public int CompareTo(object obj)
{
&nbsp;&nbsp;&nbsp; if (obj == null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;


&nbsp;&nbsp;&nbsp; Course other = obj as Course;
&nbsp;&nbsp;&nbsp; if (other != null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.CompareTo(other);
&nbsp;&nbsp;&nbsp; else throw new ArgumentException(&quot;Object is not a Course&quot;);
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal">2. Sort the datatable by the custom type</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
static void SortByCourse(DataTable table)
{
&nbsp;&nbsp;&nbsp; // Use the Select method to sort the DataTable.
&nbsp;&nbsp;&nbsp; DataRow[] resultRows = table.Select(&quot;&quot;, &quot;Course DESC&quot;);


&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;It's the result of sorting&quot;);
&nbsp;&nbsp;&nbsp; foreach (DataRow row in resultRows)
&nbsp;&nbsp;&nbsp; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(row[0]);
&nbsp;&nbsp;&nbsp; }


&nbsp;&nbsp;&nbsp; Console.WriteLine();
}

</pre>
<pre id="codePreview" class="csharp">
static void SortByCourse(DataTable table)
{
&nbsp;&nbsp;&nbsp; // Use the Select method to sort the DataTable.
&nbsp;&nbsp;&nbsp; DataRow[] resultRows = table.Select(&quot;&quot;, &quot;Course DESC&quot;);


&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;It's the result of sorting&quot;);
&nbsp;&nbsp;&nbsp; foreach (DataRow row in resultRows)
&nbsp;&nbsp;&nbsp; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(row[0]);
&nbsp;&nbsp;&nbsp; }


&nbsp;&nbsp;&nbsp; Console.WriteLine();
}

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal">3. Write the datatable into the Xml file</p>
<p class="MsoNormal">Because we use the custom type in DataTable, we must store the schema when we write DataTable into Xml file.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
table.WriteXmlSchema(xmlSchema);
table.WriteXml(xmlFile);

</pre>
<pre id="codePreview" class="csharp">
table.WriteXmlSchema(xmlSchema);
table.WriteXml(xmlFile);

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal">4. Read the Xml file into the datatable.</p>
<p class="MsoNormal">Before we load the Xml file into DataTable, we should load the schema file into DataTable.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
newTable.ReadXmlSchema(xmlSchema);
newTable.ReadXml(xmlFile);

</pre>
<pre id="codePreview" class="csharp">
newTable.ReadXmlSchema(xmlSchema);
newTable.ReadXml(xmlFile);

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
5. Implement <span class="SpellE">IXmlSerializable</span> interface</p>
<p class="MsoNormal" style="margin-bottom:0in; margin-bottom:.0001pt; line-height:normal; text-autospace:none">
It may be a little harder than <span class="SpellE">SerializableAttribute</span>, but we can get more control.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span>
</div>
<span class="hidden">csharp</span>
<pre class="hidden">
public void ReadXml(<a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Xml.XmlReader.aspx"  title="Auto generated link to System.Xml.XmlReader">System.Xml.XmlReader</a> reader)
{
&nbsp;&nbsp;&nbsp; // Because there may be many types of node, we first get the Course node.
&nbsp;&nbsp;&nbsp; reader.ReadStartElement(&quot;Course&quot;);


&nbsp;&nbsp;&nbsp; CourseId = reader.ReadElementString(&quot;CourseId&quot;);
&nbsp;&nbsp;&nbsp; Title = reader.ReadElementString(&quot;Title&quot;);


&nbsp;&nbsp;&nbsp; String CreditsString = reader.ReadElementString(&quot;Credits&quot;);
&nbsp;&nbsp;&nbsp; int credit = 0;
&nbsp;&nbsp;&nbsp; if (Int32.TryParse(CreditsString, out credit))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Credits = credit;
&nbsp;&nbsp;&nbsp; else Credits = -1;


&nbsp;&nbsp;&nbsp; reader.ReadEndElement();
}


public void WriteXml(<a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Xml.XmlWriter.aspx"  title="Auto generated link to System.Xml.XmlWriter">System.Xml.XmlWriter</a> writer)
{
&nbsp;&nbsp;&nbsp; writer.WriteElementString(&quot;CourseId&quot;, CourseId);
&nbsp;&nbsp;&nbsp; writer.WriteElementString(&quot;Title&quot;, Title);
&nbsp;&nbsp;&nbsp; writer.WriteElementString(&quot;Credits&quot;, Credits.ToString());
} 

</pre>
<pre id="codePreview" class="csharp">
public void ReadXml(<a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Xml.XmlReader.aspx"  title="Auto generated link to System.Xml.XmlReader">System.Xml.XmlReader</a> reader)
{
&nbsp;&nbsp;&nbsp; // Because there may be many types of node, we first get the Course node.
&nbsp;&nbsp;&nbsp; reader.ReadStartElement(&quot;Course&quot;);


&nbsp;&nbsp;&nbsp; CourseId = reader.ReadElementString(&quot;CourseId&quot;);
&nbsp;&nbsp;&nbsp; Title = reader.ReadElementString(&quot;Title&quot;);


&nbsp;&nbsp;&nbsp; String CreditsString = reader.ReadElementString(&quot;Credits&quot;);
&nbsp;&nbsp;&nbsp; int credit = 0;
&nbsp;&nbsp;&nbsp; if (Int32.TryParse(CreditsString, out credit))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Credits = credit;
&nbsp;&nbsp;&nbsp; else Credits = -1;


&nbsp;&nbsp;&nbsp; reader.ReadEndElement();
}


public void WriteXml(<a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Xml.XmlWriter.aspx"  title="Auto generated link to System.Xml.XmlWriter">System.Xml.XmlWriter</a> writer)
{
&nbsp;&nbsp;&nbsp; writer.WriteElementString(&quot;CourseId&quot;, CourseId);
&nbsp;&nbsp;&nbsp; writer.WriteElementString(&quot;Title&quot;, Title);
&nbsp;&nbsp;&nbsp; writer.WriteElementString(&quot;Credits&quot;, Credits.ToString());
} 

</pre>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<h2>More Information</h2>
<p class="MsoNormal"><span class="MsoHyperlink"><a href="http://msdn.microsoft.com/en-us/library/system.icomparable.compareto(v=vs.110).aspx"><span class="SpellE">CompareTo</span> Method
</a></span></p>
<p class="MsoNormal"><span class="MsoHyperlink"><a href="http://msdn.microsoft.com/en-us/library/fhd7bk0a(v=vs.110).aspx"><span class="SpellE">IXmlSerializable</span> Interface
</a></span></p>
<p class="MsoNormal"><span class="MsoHyperlink"><a href="http://msdn.microsoft.com/en-us/library/53y1t605(v=vs.110).aspx"><span class="SpellE">DataTable.WriteXmlSchema</span> Method</a>
</span></p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img alt="" src="description/95e3bc78-76ea-4f7c-8b0e-445ca740f249image.png">
</a></div>

</div>


    </div>
</body>
</html>
